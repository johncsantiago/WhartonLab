---
title: "Jude activity assay"
author: "John Santiago"
date: "2025-08-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r echo = F, fig.height=7, fig.width= 7}
library(kableExtra)
library(beeswarm)

##80mm = 400px

mm.per.pix = 0.2

fps = 30

speed.conversion = mm.per.pix*fps

raw.data.dir = "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/"
Data.Key = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/R/Data.Key.csv", row.names = 1)
row.names(Data.Key) = paste0(Data.Key$DataID, ".csv")

all.files = list.files(raw.data.dir)

all.activity.data = readRDS("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/R/all.activity.data.rds")

if(length(setdiff(all.files, names(all.activity.data[["raw.data"]]))) > 0){
  
  raw.data = all.activity.data[["raw.data"]]
  distance.data = all.activity.data[["distance.data"]]
  total.distance.data= all.activity.data[["total.distance.data"]]
  velocity.data= all.activity.data[["velocity.data"]]
  
  new.data = setdiff(all.files, names(all.activity.data[["raw.data"]]))
  add.file = 1
  while(add.file <= length(new.data)){
  raw.data[[length(raw.data)+1]] = read.csv(paste0(raw.data.dir,new.data[add.file]))
  names(raw.data)[length(raw.data)+1] = new.data[add.file]
  
    distance.data[[length(distance.data)+1]] = read.csv(paste0(raw.data.dir,new.data[add.file]))
  names(distance.data)[length(distance.data)+1] = new.data[add.file]
  
    total.distance.data[[length(total.distance.data)+1]] = read.csv(paste0(raw.data.dir,new.data[add.file]))
  names(total.distance.data)[length(total.distance.data)+1] = new.data[add.file]
  
    velocity.data[[length(velocity.data)+1]] = read.csv(paste0(raw.data.dir,new.data[add.file]))
  names(velocity.data)[length(velocity.data)+1] = new.data[add.file]
  
  }
  
  DataID = names(raw.data)
  DataID = substr(DataID,1, nchar(DataID)-4)
  data.factors = strsplit(DataID, split = "_")
  names(data.factors) = DataID
  Data.Key = data.frame(DataID = DataID,
                        Date = substr(DataID, 1,8),
                        Age = substr(DataID, 10,12),
                        Genotypes = substr(DataID,
                                           14,
                                           nchar(DataID)-7),
                        Sex = substr(DataID,
                                     nchar(DataID)-5,
                                     nchar(DataID)-5),
                        Generation = substr(DataID,
                                            nchar(DataID)-3,
                                            nchar(DataID)))
  Data.Key$TKT = "Control"
  Data.Key$TKT[grep("TKT", Data.Key$Genotypes)] = "TKT"
  
  
  analyze = 1

  while(analyze <= length(new.files)){
    
    video = new.files[analyze]
    temp.video = raw.data[video][[1]]
      
    temp.video$genotype = "WT"
    temp.video$genotype[temp.video$Arena == 1] = "A4V"
    temp.video$ObjectID = paste0(temp.video$genotype, ".", temp.video$TrackID)
    
    distance.data[video][[1]] = matrix(0, 
                                ncol = length(unique(temp.video$TrackID))+1,
                                nrow = length(unique(temp.video$Frame)))
    colnames(distance.data[video][[1]]) = c("Frame", unique(temp.video$ObjectID))  
    row.names(distance.data[video][[1]]) = 1:max(unique(temp.video$Frame))
    distance.data[video][[1]][,"Frame"] = unique(temp.video$Frame)
    
    use.frames = c(1, (1:(max(temp.video$Frame)/10))*10)
    temp = temp.video[temp.video$Frame %in% use.frames,]
    distance.data[video][[1]] = distance.data[video][[1]][distance.data[video][[1]][,"Frame"] %in% use.frames,]
    total.distance.data[video][[1]] = distance.data[video][[1]]
    velocity.data[video][[1]] = distance.data[video][[1]]
    
    i=1
    while(i<=length(unique(temp$ObjectID))){
      temp.distdata = temp[temp$ObjectID == unique(temp$ObjectID)[i],]
      j=2
      while(j<=nrow(temp.distdata)){
        x1 = temp.distdata[temp.distdata$Frame == use.frames[j-1], "CX"]
        x2 = temp.distdata[temp.distdata$Frame == use.frames[j], "CX"]
        y1 = temp.distdata[temp.distdata$Frame == use.frames[j-1], "CY"]
        y2 = temp.distdata[temp.distdata$Frame == use.frames[j], "CY"]
        deltax = x2-x1
        deltay = y2-y1
        distance.data[video][[1]][distance.data[video][[1]][,"Frame"] == use.frames[j], temp$ObjectID[i]] =
          sqrt((deltax^2) + (deltay^2))
        
        total.distance.data[video][[1]][total.distance.data[video][[1]][,"Frame"] == use.frames[j], temp$ObjectID[i]] = 
          distance.data[video][[1]][distance.data[video][[1]][,"Frame"] == use.frames[j], temp$ObjectID[i]] +
          total.distance.data[video][[1]][total.distance.data[video][[1]][,"Frame"] == use.frames[j-1], temp$ObjectID[i]]
        
        if(j>3){
        x1 = temp.distdata[temp.distdata$Frame == use.frames[j-3], "CX"]
        x2 = temp.distdata[temp.distdata$Frame == use.frames[j], "CX"]
        y1 = temp.distdata[temp.distdata$Frame == use.frames[j-3], "CY"]
        y2 = temp.distdata[temp.distdata$Frame == use.frames[j], "CY"]
        deltax = x2-x1
        deltay = y2-y1
        velocity.data[video][[1]][velocity.data[video][[1]][,"Frame"] == use.frames[j], temp$ObjectID[i]] = 
          sqrt((deltax^2) + (deltay^2))*.2
        }
        j=j+1
      }
      i=i+1
    }
    velocity.data[video][[1]] = velocity.data[video][[1]][4:nrow(velocity.data[video][[1]]),]
    analyze = analyze + 1
  }
  
  all.activity.data = list(raw.data, 
                           distance.data, 
                           total.distance.data, 
                           velocity.data)
  names(all.activity.data) = c("raw.data",
                               "distance.data",
                               "total.distance.data",
                               "velocity.data")
  ##saveRDS(all.activity.data, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/R/all.activity.data.rds")
  
  ##write.csv(Data.Key, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/R/Data.Key.csv")
}

hex = function(color, alpha){
  rgb2hex = color
  i = 1
  while(i <= length(color)){
    rgbvals = col2rgb(color[i])
    rgb2hex[i] = rgb(rgbvals[1]/255, rgbvals[2]/255, rgbvals[3]/255, alpha)
    i = i+1
  }
  return(rgb2hex)
}


```


```{r echo = F}

temp.raw.data = all.activity.data$raw.data
velocity = all.activity.data$velocity.data
i =1
while(i<=length(temp.raw.data)){
  temp.vel = velocity[[i]]
  temp.rd = temp.raw.data[[i]]
  temp.rd$Genotype = "A4V"
  temp.rd$Genotype[temp.rd$Arena == "0"] = "WT"
  temp.rd$Sample = paste0(temp.rd$Genotype, ".", temp.rd$TrackID)
  use.frames = c(1, (1:(max(temp.rd$Frame)/10))*10)
  j=2
  while(j<=ncol(temp.vel)){
    s=4
    current.rd = temp.rd[temp.rd$Sample == colnames(temp.vel)[j],]
    while(s <= nrow(temp.vel)){
       temp.x2 = current.rd[current.rd$Frame == use.frames[s], "CX"]
       temp.x1 = current.rd[current.rd$Frame == use.frames[s-3], "CX"]
       temp.y2 = current.rd[current.rd$Frame == use.frames[s], "CY"]
       temp.y1 = current.rd[current.rd$Frame == use.frames[s-3], "CY"]
       deltax = temp.x2 - temp.x1
       deltay = temp.y2 - temp.y1
       temp.vel[temp.vel[,"Frame"] == use.frames[s],j] = sqrt((deltax^2) + (deltay^2))*.2
      s=s+1
    }
  j=j+1  
  }
  temp.vel = temp.vel[temp.vel[,"Frame"] >= use.frames[4],]
  velocity[[i]] = temp.vel
  i=i+1
}

all.activity.data$velocity.data = velocity

```


```{r echo = F}

##Distance Traveled
total.distance.plot = function(file.name){
  plot.data = as.data.frame(all.activity.data$total.distance.data[[file.name]])
  plot.data[,2:ncol(plot.data)] = plot.data[,2:ncol(plot.data)] * mm.per.pix
  
  WT = plot.data[,grep("WT", colnames(plot.data))]
  A4V = plot.data[,grep("A4V", colnames(plot.data))]
  
  plot(x = NA,
       y = NA,
       ylim = c(0, max(plot.data[,2:ncol(plot.data)])),
       xlim = c(0, max(plot.data$Frame)),
       ylab = "Total Distance (mm)",
       xlab = "Frame",
       main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))
  i=1
  while(i <= ncol(WT)){
    lines(x = plot.data$Frame,
          y = WT[,i],
          col = "royalblue",
          cex = .2)
    i=i+1
  }
    i=1
  while(i <= ncol(A4V)){
    lines(x = plot.data$Frame,
          y = A4V[,i],
          col = "firebrick",
          cex = .2)
    i=i+1
  }
  
}

file.name = row.names(Data.Key)[1]
total.distance.plot(file.name)

```


```{r echo = F}

##Velocity
velocity.plot = function(file.name, velocity.cutoff){
  plot.data = as.data.frame(all.activity.data$velocity.data[[file.name]])
  plot.data[,2:ncol(plot.data)] = plot.data[,2:ncol(plot.data)]*.2
  WT = plot.data[,grep("WT", colnames(plot.data))]
  A4V = plot.data[,grep("A4V", colnames(plot.data))]
  
  
  plot(x = NA,
       y = NA,
       ylim = c(0, max(plot.data[,2:ncol(plot.data)])),
       xlim = c(0, max(plot.data$Frame)),
       ylab = "Velocity (mm/s)",
       xlab = "Frame",
       main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))
  i=1
  while(i <= ncol(WT)){
    lines(x = plot.data$Frame,
           y = WT[,i],
           col = hex("royalblue",.5),
           cex = .2)
    points(x = plot.data$Frame[WT[,i]>velocity.cutoff],
           y = WT[WT[,i]>velocity.cutoff,i],
           col = "navy",
           cex = .2)
    points(x = plot.data$Frame[WT[,i]<velocity.cutoff],
       y = WT[WT[,i]<velocity.cutoff,i],
       col = hex("lightblue",1),
       cex = .2)
    i=i+1
  }
    i=1
  while(i <= ncol(A4V)){
    lines(x = plot.data$Frame,
       y = A4V[,i],
       col = hex("red",.5),
       cex = .2)
    points(x = plot.data$Frame[A4V[,i]>velocity.cutoff],
          y = A4V[A4V[,i]>velocity.cutoff,i],
          col = "firebrick",
          cex = .2)
    points(x = plot.data$Frame[A4V[,i]<velocity.cutoff],
          y = A4V[A4V[,i]<velocity.cutoff,i],
          col = hex("pink",.5),
          cex = .2)
    i=i+1
  }
  abline(h = velocity.cutoff,
       lty = 2,
       col = "black")
  
}

file.name = row.names(Data.Key)[1]
velocity.cutoff = .075
velocity.plot(file.name, velocity.cutoff)

```


```{r echo = F}
##Specific fly

single.fly.vel = function(fly.data, velocity.cutoff){
  fly.data$Frame = fly.data$Frame/30
  
  plot(x = fly.data$Frame,
       y = fly.data[,2],
       ylim = c(0, max(fly.data[,2])),
       xlim = c(0, max(fly.data$Frame)),
       ylab = "Velocity (mm/s)",
       xlab = "Time (s)",
       main = paste(substr(Data.Key[file.name, "DataID"], 10,
                           nchar(Data.Key[file.name, "DataID"])),
                    colnames(fly.data)[2]),
       col = "grey",
       cex = .2,
       type = "l")
  
  points(x = fly.data[fly.data$Frame %in% use, 1],
         y = fly.data[fly.data$Frame %in% use, 2],
         col = "royalblue",
         cex = .2)
  
  abline(h=velocity.cutoff,
         col = "red",
         lty = 2)
}

```

```{r echo = F}

plot.data = as.data.frame(all.activity.data$velocity.data[[file.name]])
plot.data[,2:ncol(plot.data)] = plot.data[,2:ncol(plot.data)]*.2

fly.data = plot.data[,c("Frame", "A4V.1")]
single.fly.vel(fly.data, velocity.cutoff)



```
  
  
```{r echo = F}

plot.data = as.data.frame(all.activity.data$velocity.data[[file.name]])
plot.data[,2:ncol(plot.data)] = plot.data[,2:ncol(plot.data)]*.2

par(mfrow = c(1,2))

fly.data = plot.data[,c("Frame", "WT.30")]
single.fly.vel(fly.data, velocity.cutoff)

fly.data = plot.data[,c("Frame", "WT.26")]
single.fly.vel(fly.data, velocity.cutoff)

```


  
```{r echo = F}

activity.summary = all.activity.data$velocity.data
temp.velocity = all.activity.data$velocity.data
temp.total.dist = all.activity.data$total.distance.data
i = 1
while(i<=length(activity.summary)){
  temp.summary = data.frame(Sample = colnames(temp.velocity[[i]])[2:ncol(temp.velocity[[i]])],
                            Genotype = "A4V",
                            Total.Points = nrow(temp.velocity[[i]]),
                            Moving = 0,
                            Still = 0,
                            Average.Velocity = 0,
                            total.distance = 0)
  temp.summary$Genotype[grep("WT", temp.summary$Sample)] = "WT"
  j = 1
  while(j <= nrow(temp.summary)){
    Sample.Data = temp.velocity[[i]][,j+1]
    temp.summary[j, "Moving"] = length(Sample.Data[Sample.Data>velocity.cutoff])
    temp.summary[j, "Still"] = length(Sample.Data[Sample.Data<velocity.cutoff])
    temp.summary[j, "Average.Velocity"] = sum(Sample.Data[Sample.Data>velocity.cutoff])/length(Sample.Data[Sample.Data>velocity.cutoff])
    if(temp.summary[j,"Moving"] == 0){
      temp.summary[j,"Average.Velocity"] = 0
    }
    temp.summary[j, "total.distance"] = max(temp.total.dist[[i]][,j+1])
    j=j+1
  }
  activity.summary[[i]] = temp.summary
  i=i+1
}


```
  

```{r echo = F, fig.width= 10, fig.height= 7}

file.name = row.names(Data.Key)[70]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(summary.data$Genotype, levels = c("WT", "A4V"))

combined = summary.data


file.name = row.names(Data.Key)[69]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(summary.data$Genotype, levels = c("WT", "A4V"))

combined = rbind(combined, summary.data)

file.name = row.names(Data.Key)[68]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(summary.data$Genotype, levels = c("WT", "A4V"))

summary.data = rbind(combined, summary.data)

still.p = t.test(summary.data$Still[summary.data$Genotype == "WT"],
       summary.data$Still[summary.data$Genotype == "A4V"],
       paired = F)

moving.p = t.test(summary.data$Moving[summary.data$Genotype == "WT"],
       summary.data$Moving[summary.data$Genotype == "A4V"],
       paired = F)

average.velocity.p = t.test(summary.data$Average.Velocity[summary.data$Genotype == "WT"],
       summary.data$Average.Velocity[summary.data$Genotype == "A4V"],
       paired = F)

total.dist.p = t.test(summary.data$total.distance[summary.data$Genotype == "WT"],
       summary.data$total.distance[summary.data$Genotype == "A4V"],
       paired = F)


par(mfrow = c(1,4))

boxplot(summary.data$Still~summary.data$Genotype,
        col = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Time Still (%)",
        ylim = c(0, 100),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Still~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)

text(x = 1.5,
     y = 50,
     label = paste0("pval: ", signif(still.p[[3]], 3)))


boxplot(summary.data$Moving~summary.data$Genotype,
        col = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Time Moving (%)",
        ylim = c(0, 100),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Moving~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)

text(x = 1.5,
     y = 50,
     label = paste0("pval: ", signif(moving.p[[3]], 3)))

boxplot(summary.data$Average.Velocity~summary.data$Genotype,
        col = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Average Velocity (mm/s)",
        ylim = c(0, max(summary.data$Average.Velocity)),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Average.Velocity~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)
text(x = 2,
     y = 7,
     label = paste0("pval: ", signif(average.velocity.p[[3]], 3)))


boxplot(summary.data$total.distance~summary.data$Genotype,
        col = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Average Velocity (mm/s)",
        ylim = c(0, max(summary.data$total.distance)),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$total.distance~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)
text(x = 2,
     y = max(summary.data$total.distance)*.85,
     label = paste0("pval: ", signif(total.dist.p[[3]], 3)))

```
  
  
```{r echo = F, fig.width= 10, fig.height= 7}

file.name = row.names(Data.Key)[67]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(summary.data$Genotype, levels = c("WT", "A4V"))

combined = summary.data


file.name = row.names(Data.Key)[66]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(summary.data$Genotype, levels = c("WT", "A4V"))

combined = rbind(combined, summary.data)

file.name = row.names(Data.Key)[65]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(summary.data$Genotype, levels = c("WT", "A4V"))

summary.data = rbind(combined, summary.data)

still.p = t.test(summary.data$Still[summary.data$Genotype == "WT"],
       summary.data$Still[summary.data$Genotype == "A4V"],
       paired = F)

moving.p = t.test(summary.data$Moving[summary.data$Genotype == "WT"],
       summary.data$Moving[summary.data$Genotype == "A4V"],
       paired = F)

average.velocity.p = t.test(summary.data$Average.Velocity[summary.data$Genotype == "WT"],
       summary.data$Average.Velocity[summary.data$Genotype == "A4V"],
       paired = F)

total.dist.p = t.test(summary.data$total.distance[summary.data$Genotype == "WT"],
       summary.data$total.distance[summary.data$Genotype == "A4V"],
       paired = F)


par(mfrow = c(1,4))

boxplot(summary.data$Still~summary.data$Genotype,
        col = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Time Still (%)",
        ylim = c(0, 100),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Still~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)

text(x = 1.5,
     y = 50,
     label = paste0("pval: ", signif(still.p[[3]], 3)))


boxplot(summary.data$Moving~summary.data$Genotype,
        col = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Time Moving (%)",
        ylim = c(0, 100),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Moving~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)

text(x = 1.5,
     y = 50,
     label = paste0("pval: ", signif(moving.p[[3]], 3)))

boxplot(summary.data$Average.Velocity~summary.data$Genotype,
        col = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Average Velocity (mm/s)",
        ylim = c(0, max(summary.data$Average.Velocity)),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Average.Velocity~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)
text(x = 2,
     y = 10,
     label = paste0("pval: ", signif(average.velocity.p[[3]], 3)))


boxplot(summary.data$total.distance~summary.data$Genotype,
        col = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Average Velocity (mm/s)",
        ylim = c(0, max(summary.data$total.distance)),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$total.distance~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)
text(x = 2,
     y = max(summary.data$total.distance)*.85,
     label = paste0("pval: ", signif(total.dist.p[[3]], 3)))

```  


```{r echo = F, fig.width= 10, fig.height= 7}

file.name = row.names(Data.Key)[64]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(paste0(summary.data$Genotype,".TKT.M"), levels = c("WT.TKT.M", "A4V.TKT.M"))

combined = summary.data


file.name = row.names(Data.Key)[62]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(paste0(summary.data$Genotype,".M"), levels = c("WT.M", "A4V.M"))

summary.data = rbind(combined, summary.data)

summary.data$Genotype = factor(summary.data$Genotype, 
                               levels = c("WT.M", "A4V.M",
                                          "WT.TKT.M","A4V.TKT.M"))

summary.data = summary.data[order(summary.data$Genotype),]

c.still.p = t.test(summary.data$Still[summary.data$Genotype == "WT.M"],
       summary.data$Still[summary.data$Genotype == "A4V.M"],
       paired = F)
t.still.p = t.test(summary.data$Still[summary.data$Genotype == "WT.TKT.M"],
       summary.data$Still[summary.data$Genotype == "A4V.TKT.M"],
       paired = F)

c.moving.p = t.test(summary.data$Moving[summary.data$Genotype == "WT.M"],
       summary.data$Moving[summary.data$Genotype == "A4V.M"],
       paired = F)
t.moving.p = t.test(summary.data$Moving[summary.data$Genotype == "WT.TKT.M"],
       summary.data$Moving[summary.data$Genotype == "A4V.TKT.M"],
       paired = F)

c.average.velocity.p = t.test(summary.data$Average.Velocity[summary.data$Genotype == "WT.M"],
       summary.data$Average.Velocity[summary.data$Genotype == "A4V.M"],
       paired = F)
t.average.velocity.p = t.test(summary.data$Average.Velocity[summary.data$Genotype == "WT.TKT.M"],
       summary.data$Average.Velocity[summary.data$Genotype == "A4V.TKT.M"],
       paired = F)

c.total.dist.p = t.test(summary.data$total.distance[summary.data$Genotype == "WT.M"],
       summary.data$total.distance[summary.data$Genotype == "A4V.M"],
       paired = F)
t.total.dist.p = t.test(summary.data$total.distance[summary.data$Genotype == "WT.TKT.M"],
       summary.data$total.distance[summary.data$Genotype == "A4V.TKT.M"],
       paired = F)


par(mfrow = c(1,4))

boxplot(summary.data$Still~summary.data$Genotype,
        col = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Time Still (%)",
        ylim = c(0, 100),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Still~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)

text(x = 1.5,
     y = 20,
     label = paste0("pval: ", signif(c.still.p[[3]], 3)))
text(x = 3.5,
     y = 20,
     label = paste0("pval: ", signif(t.still.p[[3]], 3)))


boxplot(summary.data$Moving~summary.data$Genotype,
        col = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Time Moving (%)",
        ylim = c(0, 100),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Moving~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)

text(x = 1.5,
     y = 80,
     label = paste0("pval: ", signif(c.moving.p[[3]], 3)))
text(x = 3.5,
     y = 80,
     label = paste0("pval: ", signif(t.moving.p[[3]], 3)))

boxplot(summary.data$Average.Velocity~summary.data$Genotype,
        col = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Average Velocity (mm/s)",
        ylim = c(0, max(summary.data$Average.Velocity)),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Average.Velocity~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)
text(x = 1.5,
     y = 10,
     label = paste0("pval: ", signif(c.average.velocity.p[[3]], 3)))
text(x = 3.5,
     y = 10,
     label = paste0("pval: ", signif(t.average.velocity.p[[3]], 3)))


boxplot(summary.data$total.distance~summary.data$Genotype,
        col = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Average Velocity (mm/s)",
        ylim = c(0, max(summary.data$total.distance)),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$total.distance~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)
text(x = 1.5,
     y = 10100,
     label = paste0("pval: ", signif(c.total.dist.p[[3]], 3)))
text(x = 3.5,
     y = 10100,
     label = paste0("pval: ", signif(t.total.dist.p[[3]], 3)))

```

```{r echo = F, fig.width= 10, fig.height= 7}

file.name = row.names(Data.Key)[63]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(paste0(summary.data$Genotype,".TKT.F"), levels = c("WT.TKT.F", "A4V.TKT.F"))

combined = summary.data


file.name = row.names(Data.Key)[61]

summary.data = activity.summary[[file.name]]

summary.data$Still = 100*summary.data$Still/summary.data$Total.Points
summary.data$Moving = 100*summary.data$Moving/summary.data$Total.Points
summary.data$Genotype = factor(paste0(summary.data$Genotype,".F"), levels = c("WT.F", "A4V.F"))

summary.data = rbind(combined, summary.data)

summary.data$Genotype = factor(summary.data$Genotype, 
                               levels = c("WT.F", "A4V.F",
                                          "WT.TKT.F","A4V.TKT.F"))

summary.data = summary.data[order(summary.data$Genotype),]

c.still.p = t.test(summary.data$Still[summary.data$Genotype == "WT.F"],
       summary.data$Still[summary.data$Genotype == "A4V.F"],
       paired = F)
t.still.p = t.test(summary.data$Still[summary.data$Genotype == "WT.TKT.F"],
       summary.data$Still[summary.data$Genotype == "A4V.TKT.F"],
       paired = F)

c.moving.p = t.test(summary.data$Moving[summary.data$Genotype == "WT.F"],
       summary.data$Moving[summary.data$Genotype == "A4V.F"],
       paired = F)
t.moving.p = t.test(summary.data$Moving[summary.data$Genotype == "WT.TKT.F"],
       summary.data$Moving[summary.data$Genotype == "A4V.TKT.F"],
       paired = F)

c.average.velocity.p = t.test(summary.data$Average.Velocity[summary.data$Genotype == "WT.F"],
       summary.data$Average.Velocity[summary.data$Genotype == "A4V.F"],
       paired = F)
t.average.velocity.p = t.test(summary.data$Average.Velocity[summary.data$Genotype == "WT.TKT.F"],
       summary.data$Average.Velocity[summary.data$Genotype == "A4V.TKT.F"],
       paired = F)

c.total.dist.p = t.test(summary.data$total.distance[summary.data$Genotype == "WT.F"],
       summary.data$total.distance[summary.data$Genotype == "A4V.F"],
       paired = F)
t.total.dist.p = t.test(summary.data$total.distance[summary.data$Genotype == "WT.TKT.F"],
       summary.data$total.distance[summary.data$Genotype == "A4V.TKT.F"],
       paired = F)


par(mfrow = c(1,4))

boxplot(summary.data$Still~summary.data$Genotype,
        col = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Time Still (%)",
        ylim = c(0, 100),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Still~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)

text(x = 1.5,
     y = 20,
     label = paste0("pval: ", signif(c.still.p[[3]], 3)))
text(x = 3.5,
     y = 20,
     label = paste0("pval: ", signif(t.still.p[[3]], 3)))


boxplot(summary.data$Moving~summary.data$Genotype,
        col = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Time Moving (%)",
        ylim = c(0, 100),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Moving~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)

text(x = 1.5,
     y = 80,
     label = paste0("pval: ", signif(c.moving.p[[3]], 3)))
text(x = 3.5,
     y = 80,
     label = paste0("pval: ", signif(t.moving.p[[3]], 3)))

boxplot(summary.data$Average.Velocity~summary.data$Genotype,
        col = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Average Velocity (mm/s)",
        ylim = c(0, max(summary.data$Average.Velocity)),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$Average.Velocity~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)
text(x = 1.5,
     y = 12.75,
     label = paste0("pval: ", signif(c.average.velocity.p[[3]], 3)))
text(x = 3.5,
     y = 12.75,
     label = paste0("pval: ", signif(t.average.velocity.p[[3]], 3)))


boxplot(summary.data$total.distance~summary.data$Genotype,
        col = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5), 
        xlab = "", ylab = "Average Velocity (mm/s)",
        ylim = c(0, max(summary.data$total.distance)),
        main = substr(Data.Key[file.name, "DataID"], 10, nchar(Data.Key[file.name, "DataID"])))

beeswarm(summary.data$total.distance~summary.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("navy","firebrick",
                    "darkgreen","gold")[unique(as.numeric(summary.data$Genotype))],.5),
       add = T)
text(x = 1.5,
     y = 10100,
     label = paste0("pval: ", signif(c.total.dist.p[[3]], 3)))
text(x = 3.5,
     y = 10100,
     label = paste0("pval: ", signif(t.total.dist.p[[3]], 3)))

```








```{r echo = F}

library(dplyr)


raw.data.dir = "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/"
Data.Key = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/R/Data.Key.csv", row.names = 1)
row.names(Data.Key) = paste0(Data.Key$DataID, ".csv")

all.files = list.files(raw.data.dir)

df = read.csv(paste0(raw.data.dir, all.files[1]))

df <- df %>%
  arrange(TrackID, Frame) %>%
  group_by(TrackID) %>%
  dplyr::mutate(
    dx = CX - lag(CX),
    dy = CY - lag(CY),
    disp = sqrt(dx^2 + dy^2)
  )

library(slider)

df <- df %>%
  group_by(TrackID) %>%
  dplyr::mutate(
    disp_smooth = slide_dbl(disp, median, .before = 2, .after = 2, .complete = TRUE)
  )

min_disp <- 1.5

df <- df %>%
  group_by(TrackID) %>%
  dplyr::mutate(
    noise_med  = median(disp, na.rm = TRUE),
    noise_mad  = mad(disp, constant = 1, na.rm = TRUE),
    move_thresh = pmax(noise_med + 5 * noise_mad, min_disp)
  )

df <- df %>%
  group_by(TrackID) %>%
  dplyr::mutate(
    moving_raw = disp_smooth > move_thresh,
    moving = slide_lgl(
      moving_raw,
      ~ sum(.x, na.rm = TRUE) >= 3,
      .before = 2,
      .after = 2,
      .complete = TRUE
    )
  )

df <- df %>%
  group_by(TrackID) %>%
  dplyr::mutate(
    area_med = median(Area, na.rm = TRUE),
    bad_area = Area > 1.8 * area_med
  )

df <- df %>%
  mutate(
    moving_final = moving & !bad_area
  )


```


```{r echo = F}

df2 = read.csv(paste0(raw.data.dir, all.files[1]))

df2=df2[order(df2$Frame),]
df2=df2[order(df2$TrackID),]
df2$dx = NA
df2$dy = NA
df2$disp = NA

i=1
while(i<=length(unique(df2$TrackID))){
  temp = df2[df2$TrackID == i,c("CX", "CX","CY","CY")]
  temp$CX = c(NA, temp$CX[1:(nrow(temp)-1)])
  temp$CY = c(NA, temp$CY[1:(nrow(temp)-1)])
  temp$dx = temp$CX.1 - temp$CX
  temp$dy = temp$CY.1 - temp$CY
  temp$disp = sqrt(temp$dx^2 + temp$dy^2)
  df2[df2$TrackID == i, c("dx","dy","disp")] = temp[,c("dx","dy","disp")]
  i=i+1
}

```


```{r echo = F}

## ---------- 0) sort like arrange(TrackID, Frame) ----------
o <- order(df$TrackID, df$Frame)
df <- df[o, ]

## convenient split index
idx <- split(seq_len(nrow(df)), df$TrackID)

## ---------- 1) dx, dy, disp (within TrackID) ----------
df$dx <- NA_real_
df$dy <- NA_real_
df$disp <- NA_real_

for (g in idx) {
  cx <- df$CX[g]
  cy <- df$CY[g]
  df$dx[g] <- c(NA_real_, diff(cx))
  df$dy[g] <- c(NA_real_, diff(cy))
  df$disp[g] <- sqrt(df$dx[g]^2 + df$dy[g]^2)
}

## ---------- helpers: centered rolling median / rolling ">=k trues" ----------
roll_median_centered <- function(x, k = 5) {
  stopifnot(k %% 2 == 1)
  n <- length(x)
  out <- rep(NA_real_, n)
  h <- (k - 1) / 2
  if (n < k) return(out)
  for (i in (1 + h):(n - h)) {
    out[i] <- median(x[(i - h):(i + h)], na.rm = TRUE)
  }
  out
}

roll_atleast_k_true_centered <- function(x, k = 5, atleast = 3) {
  stopifnot(k %% 2 == 1)
  n <- length(x)
  out <- rep(NA, n)
  h <- (k - 1) / 2
  if (n < k) return(out)
  # treat NA as FALSE for the "sum >= atleast" rule (matches your na.rm=TRUE behavior)
  xi <- ifelse(is.na(x), FALSE, x)
  for (i in (1 + h):(n - h)) {
    out[i] <- sum(xi[(i - h):(i + h)]) >= atleast
  }
  out
}

## ---------- 2) disp_smooth = centered 5-frame median ----------
df$disp_smooth <- NA_real_
for (g in idx) {
  df$disp_smooth[g] <- roll_median_centered(df$disp[g], k = 5)
}

## ---------- 3) per-fly noise floor + threshold ----------
min_disp <- 1.5

df$noise_med <- NA_real_
df$noise_mad <- NA_real_
df$move_thresh <- NA_real_

for (g in idx) {
  d <- df$disp[g]
  nm <- median(d, na.rm = TRUE)
  nd <- mad(d, constant = 1, na.rm = TRUE)
  df$noise_med[g]  <- nm
  df$noise_mad[g]  <- nd
  df$move_thresh[g] <- max(nm + 5 * nd, min_disp)
}

## ---------- 4) moving_raw + moving persistence (>=3 TRUE in 5-frame window) ----------
df$moving_raw <- NA
df$moving <- NA

for (g in idx) {
  ms <- df$disp_smooth[g]
  thr <- df$move_thresh[g][1]   # constant within track
  df$moving_raw[g] <- ms > thr
  df$moving[g] <- roll_atleast_k_true_centered(df$moving_raw[g], k = 5, atleast = 3)
}

## ---------- 5) area_med + bad_area ----------
df$area_med <- NA_real_
df$bad_area <- NA

for (g in idx) {
  am <- median(df$Area[g], na.rm = TRUE)
  df$area_med[g] <- am
  df$bad_area[g] <- df$Area[g] > 1.8 * am
}

## ---------- 6) moving_final ----------
df$moving_final <- with(df, moving & !bad_area)


```


```{r echo = F}

process_one_file <- function(df, min_disp = 1.5, k_mad = 5,
                             smooth_k = 5, vote_k = 5, vote_need = 3,
                             bad_area_mult = 1.8) {

  # 1) Ensure sorted by TrackID, Frame (critical for diff/rolling)
  o <- order(df$TrackID, df$Frame)
  df <- df[o, ]

  # Preallocate output columns (fast; avoids growing vectors)
  n <- nrow(df)
  df$dx <- NA_real_
  df$dy <- NA_real_
  df$disp <- NA_real_
  df$disp_smooth <- NA_real_
  df$noise_med <- NA_real_
  df$noise_mad <- NA_real_
  df$move_thresh <- NA_real_
  df$moving_raw <- NA
  df$moving <- NA
  df$area_med <- NA_real_
  df$bad_area <- NA
  df$moving_final <- NA

  # 2) Group indices by TrackID (few groups → loop is cheap)
  ids <- df$TrackID
  grp <- split(seq_len(n), ids)

  # helpers
  half_smooth <- (smooth_k - 1) / 2
  half_vote   <- (vote_k - 1) / 2

  for (g in grp) {
    cx <- df$CX[g]
    cy <- df$CY[g]

    # dx,dy,disp
    dx <- c(NA_real_, diff(cx))
    dy <- c(NA_real_, diff(cy))
    disp <- sqrt(dx*dx + dy*dy)

    # rolling median smooth (centered). runmed requires odd k.
    # endrule="constant" gives NAs near edges if you want; "median" or "keep" are other options.
    disp_s <- stats::runmed(disp, k = smooth_k, endrule = "constant")

    # per-fly noise floor on *smoothed* or raw disp (choose one; smoothed is usually better)
    nm <- stats::median(disp_s, na.rm = TRUE)
    madv <- stats::mad(disp_s, constant = 1, na.rm = TRUE)

    # IMPORTANT FIX: enforce a minimum threshold to avoid 0 → any 1 px jump = "moving"
    thr <- max(nm + k_mad * madv, min_disp)

    moving_raw <- disp_s > thr

    # rolling vote: at least vote_need TRUE in a centered window of vote_k
    # Convert logical to 0/1, treat NA as 0
    xi <- ifelse(is.na(moving_raw), 0L, as.integer(moving_raw))
    cnt <- stats::filter(xi, rep(1, vote_k), sides = 2)
    moving <- as.logical(cnt >= vote_need)

    # area-based merge flag
    amed <- stats::median(df$Area[g], na.rm = TRUE)
    bad_area <- df$Area[g] > (bad_area_mult * amed)

    # final
    moving_final <- moving & !bad_area

    # write back
    df$dx[g] <- dx
    df$dy[g] <- dy
    df$disp[g] <- disp
    df$disp_smooth[g] <- disp_s
    df$noise_med[g] <- nm
    df$noise_mad[g] <- madv
    df$move_thresh[g] <- thr
    df$moving_raw[g] <- moving_raw
    df$moving[g] <- moving
    df$area_med[g] <- amed
    df$bad_area[g] <- bad_area
    df$moving_final[g] <- moving_final
  }

  df
}

raw.data.dir = "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/"

all.files = list.files(raw.data.dir)
raw.data = as.list(as.character(all.files))
names(raw.data) = as.character(all.files)


Data.Key = data.frame(DataFile = all.files,
                      Date = substr(all.files, 1,8),
                      Age = substr(all.files, 10,12),
                      Genotypes = substr(all.files,
                                         14,
                                         nchar(all.files)-11),
                      Sex = substr(all.files,
                                   nchar(all.files)-9,
                                   nchar(all.files)-9),
                      Generation = substr(all.files,
                                          nchar(all.files)-7,
                                          nchar(all.files)-4))
Data.Key$TKT = "Control"
Data.Key$TKT[grep("TKT", Data.Key$Genotypes)] = "TKT"

total.dist = data.frame(DataFile = NA_real_,
                      Date = NA_real_,
                      Age = NA_real_,
                      Genotypes = NA_real_,
                      Sex = NA_real_,
                      Generation = NA_real_,
                      TKT = NA_real_,
                      Genotype = NA_real_,
                      TrackID = NA_real_,
                      Distance = NA_real_,
                      Frames = NA_real_)



i = 1
while(i<=length(all.files)){
  df = read.csv(paste0(raw.data.dir, all.files[i]))
  #use.frames = c(1:max(df$Frame)) #c(1,1:(max(df$Frame)/10))*10)
  #df = df[df$Frame %in% use.frames,]
  df2 = process_one_file(df, min_disp = 0.5, k_mad = 5,
                             smooth_k = 5, vote_k = 5, vote_need = 3,
                             bad_area_mult = 1.8) 
  
  df2$Genotype = "A4V"
  df2$Genotype[df2$Arena == "0"] = "WT"
  
  temp.dist = data.frame(Genotype = NA_real_,
                         TrackID = unique(df2$TrackID),
                         Distance = NA_real_,
                         Frames = max(df2$Frame))
  temp.dist = cbind(Data.Key[rep(i, nrow(temp.dist)),], temp.dist)
  j= 1
  while(j <= nrow(temp.dist)){
    temp.dist$Distance[j] = sum(na.omit(df2$disp[df2$TrackID == temp.dist$TrackID[j]]))
    temp.dist$Genotype[j] = unique(df2$Genotype[df2$TrackID == temp.dist$TrackID[j]])
    j=j+1
  }
  total.dist = rbind(total.dist,temp.dist)
  raw.data[[i]] = df2
  i=i+1
}


row.names(total.dist) = 1:nrow(total.dist)

##write.csv(total.dist, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/R/total.dist.csv", row.names = 1)

```


```{r echo = F}

#Resolving Video for 20260110_WTA4V_M_3.1 WT and A4V are switched sides
#temp = read.csv("/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/20260110_D17_WTA4V_M_G3.1.csv")
#write.csv(temp, "/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/20260110_D17_WTA4V_M_G3.1.csv", row.names = F)

#Resolving Video for 20260111_WTA4V_M_3.1 and 20260111_WTA4V_F_3.1
#Mixed up A4V Males and Females so that:
#     females are in 20260111_WTA4V_M_3.1
#     males are in 20260111_WTA4V_F_3.1

#M3.1 = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_WTA4V_M_G3.1.csv")
#F3.1 = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_WTA4V_F_G3.1.csv")

#WTM = M3.1[M3.1$Arena == 0,]
#A4VF = M3.1[M3.1$Arena == 1,]

#WTF = F3.1[F3.1$Arena == 0,]
#A4VM = F3.1[F3.1$Arena == 1,]

#write.csv(WTM, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_WT_M_G3.1.csv", row.names = F)

#write.csv(A4VM, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_A4V_M_G3.1.csv", row.names = F)

#write.csv(WTF, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_WT_F_G3.1.csv", row.names = F)

#write.csv(A4VF, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_A4V_F_G3.1.csv", row.names = F)

#temp = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_WT_M_G3.1.csv")
#temp2 = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_A4V_M_G3.1.csv")
#M = rbind(temp2,temp)
#write.csv(M, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_WTA4V_M_G3.1.csv", row.names = F)

#temp = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_WT_F_G3.1.csv")
#temp2 = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_A4V_F_G3.1.csv")
#Female = rbind(temp2,temp)
#write.csv(Female, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260111_D18_WTA4V_F_G3.1.csv", row.names = F)


#Resolving 20260112_D19_WTA4V_F_G3.1 loses track of fly 32 at 2:08 but fly 32 stays with 34 until the end 
#temp = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260112_D19_WTA4V_F_G3.1.csv")
#fly32 = temp[temp$TrackID==32,]
#fly32 = fly32[fly32$Frame > 3840,]


##Resolving the issue with 2026/01/23 
  ##WTM A4VM TKT G4.1 is actually  A4VFTKTG4.1 and A4VMTKTG4.1
  ##WTF A4VF TKT G4.1 is actually WTFTKTG4.1 and WTMTKTG4.1
        ##These are also the 6 and 7 video instead of 13 and 14

#temp1 = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/Pre-revised files/20260123_D29_WTA4VTKT_M_G4.1_old.csv")

#temp1.A4VF = temp1[temp1$Arena == "0",]
#temp1.A4VF$Arena = 1
  
#temp1.A4VM = temp1[temp1$Arena == "1",]

#temp2 = read.csv("/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/Pre-revised files/20260123_D29_WTA4VTKT_F_G4.1_old.csv")

#temp2.WTF = temp2[temp2$Arena == "0",]
  
#temp2.WTM = temp2[temp2$Arena == "1",]
#temp2.WTM$Arena = 0
  
#temp.male = rbind(temp2.WTM, temp1.A4VM)
#temp.female = rbind(temp2.WTF, temp1.A4VF)

#write.csv(temp.male, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260123_D29_WTA4VTKT_M_G4.1.csv", row.names = F)

#write.csv(temp.female, "/Users/johncsantiago/Documents/GitHub/WhartonLab/Activity Tracking Data/WTA4V_TKTDf/TrackingData/20260123_D29_WTA4VTKT_F_G4.1.csv", row.names = F)

```


```{r echo = F}

disp.plot = function(filenum){
  plot.data = as.data.frame(raw.data[[all.files[filenum]]])
  #plot.data[,'disp'] = plot.data[,'disp']*.2
  WT = plot.data[plot.data$Arena == 0,]
  A4V = plot.data[plot.data$Arena == 1,]
  
  
  plot(x = NA,
       y = NA,
       ylim = c(0, max(na.omit(plot.data[,'disp']))),
       xlim = c(0, max(na.omit(plot.data$Frame))),
       ylab = "Displacement (px/10 Frames)",
       xlab = "Frame")
  i=1
  while(i <= length(unique(WT$TrackID))){
    temp.plotdata = WT[WT$TrackID == unique(WT$TrackID)[i],]
    if(temp.plotdata$move_thresh[1] > 1){
      temp.plotdata$move_thresh = 1
    }
    lines(x = temp.plotdata$Frame,
           y = temp.plotdata$disp,
           col = hex("royalblue",.5),
           cex = .2)
    points(x = temp.plotdata$Frame[temp.plotdata$disp>
                                     temp.plotdata$move_thresh[1]],
           y = temp.plotdata$disp[temp.plotdata$disp>
                                    temp.plotdata$move_thresh[1]],
           col = "navy",
           cex = .2)
    points(x = temp.plotdata$Frame[temp.plotdata$disp<=
                                     temp.plotdata$move_thresh[1]],
           y = temp.plotdata$disp[temp.plotdata$disp<=
                                    temp.plotdata$move_thresh[1]],
          col = hex("lightblue",1),
          cex = .2)
    i=i+1
  }
  
    i=1
  while(i <= length(unique(A4V$TrackID))){
    temp.plotdata = A4V[A4V$TrackID == unique(A4V$TrackID)[i],]
        if(temp.plotdata$move_thresh[1] > 1){
          temp.plotdata$move_thresh = 1
        }
    lines(x = temp.plotdata$Frame,
           y = temp.plotdata$disp,
           col = hex("red",.5),
           cex = .2)
    points(x = temp.plotdata$Frame[temp.plotdata$disp>
                                     temp.plotdata$move_thresh[1]],
           y = temp.plotdata$disp[temp.plotdata$disp>
                                    temp.plotdata$move_thresh[1]],
           col = "firebrick",
           cex = .2)
    points(x = temp.plotdata$Frame[temp.plotdata$disp<=
                                     temp.plotdata$move_thresh[1]],
           y = temp.plotdata$disp[temp.plotdata$disp<=
                                    temp.plotdata$move_thresh[1]],
          col = hex("pink",1),
          cex = .2)
    i=i+1
  }
  
}

filenum = 174
disp.plot(filenum)

```

```{r echo = F}

singlefly.disp.plot = function(filenum, ID){
  plot.data = as.data.frame(raw.data[[all.files[filenum]]])
  plot.data = plot.data[plot.data$TrackID == ID,]
  
  
  plot(x = NA,
       y = NA,
       ylim = c(0, max(na.omit(plot.data[,'disp']))),
       xlim = c(1000, 1500),#c(0, max(na.omit(plot.data$Frame))),
       ylab = "Displacement (px/10 Frames)",
       xlab = "Frame")
  
  if(plot.data$Arena[1] == 0){
    if(plot.data$move_thresh[1] > 1){
      plot.data$move_thresh = 1
    }
    lines(x = plot.data$Frame,
           y = plot.data$disp,
           col = hex("royalblue",.5),
           cex = .2)
    points(x = plot.data$Frame[plot.data$disp>
                                 plot.data$move_thresh[1]],
           y = plot.data$disp[plot.data$disp>
                                plot.data$move_thresh[1]],
           col = "navy",
           cex = .2)
    points(x = plot.data$Frame[plot.data$disp<=
                                 plot.data$move_thresh[1]],
           y = plot.data$disp[plot.data$disp<=
                                plot.data$move_thresh[1]],
          col = hex("lightblue",1),
          cex = .2)
    i=i+1
  }
  

  if(plot.data$Arena[1] == 1){
        if(plot.data$move_thresh[1] > 1){
          plot.data$move_thresh = 1
        }
    lines(x = plot.data$Frame,
           y = plot.data$disp,
           col = hex("red",.5),
           cex = .2)
    points(x = plot.data$Frame[plot.data$disp>
                                     plot.data$move_thresh[1]],
           y = plot.data$disp[plot.data$disp>
                                    plot.data$move_thresh[1]],
           col = "firebrick",
           cex = .2)
    points(x = plot.data$Frame[plot.data$disp<=
                                     plot.data$move_thresh[1]],
           y = plot.data$disp[plot.data$disp<=
                                    plot.data$move_thresh[1]],
          col = hex("pink",1),
          cex = .2)
    i=i+1
  }
  
}

filenum = 174
ID = 15
singlefly.disp.plot(filenum, ID)

```

```{r echo = F}

  plot.data = as.data.frame(raw.data[[all.files[filenum]]])
  plot.data$move_thresh[plot.data$move_thresh >1] = 1
  move.data = plot.data[plot.data$moving_final ==T,]
  move.data = move.data[-grep("NA", as.character(na.omit(row.names(move.data)))),]
  row.names(move.data) = c(1:nrow(move.data))
  total.movedisp = unique(plot.data[,c("TrackID", "Arena")])
  total.movedisp$total.disp = 0
  i = 1
  while(i <= nrow(total.movedisp)){
    temp = move.data$disp[move.data$TrackID == total.movedisp$TrackID[i]]
    temp = sum(temp)/length(temp)
    if(is.na(temp) == F){
      total.movedisp[i, "total.disp"] = temp
    }
    i=i+1
  }
  
  WT = total.movedisp[total.movedisp$Arena == 0,]
  A4V = total.movedisp[total.movedisp$Arena == 1,]

  par(mfrow = c(1,2))
  hist(WT$total.disp, breaks = 100, xlim = c(0,25))
  hist(A4V$total.disp, breaks = 100, xlim = c(0,25))
  
```


```{r echo = F}

plot.data = na.omit(total.dist[(total.dist$Generation == "G2.1" |
                                 total.dist$Generation == "G2.2" |
                                 total.dist$Generation == "G2.3") & 
                                 total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))



plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

if(length(unique(plot.data$TKT)) == 1){
  plot.data = plot.data[order(plot.data$Genotype, decreasing = T),]
plot.data = plot.data[order(plot.data$Age),]
  plot.data$Category = factor(paste0(plot.data$Genotype, ".",plot.data$Age),
                            levels = unique(paste0(plot.data$Genotype, ".",plot.data$Age)))
  plot.data$Genotype = factor(plot.data$Genotype, levels = c("WT", "A4V"))
}

if(length(unique(plot.data$TKT)) == 2){
  plot.data = plot.data[order(plot.data$TKT),]
  plot.data = plot.data[order(plot.data$Genotype, decreasing = T),]

  plot.data = plot.data[order(plot.data$Age),]
  plot.data$Category = factor(paste0(plot.data$Genotype, ".",
                                     plot.data$TKT, ".",
                                     plot.data$Age),
                            levels = unique(paste0(plot.data$Genotype, ".",
                                                   plot.data$TKT, ".",
                                                   plot.data$Age)))
  plot.data$Genotype = paste0(plot.data$Genotype, ".", plot.data$TKT)
  plot.data$Genotype = factor(plot.data$Genotype, levels = unique(plot.data$Genotype))
}

plot.data$Distance = .2*300*(plot.data$Distance/plot.data$Frames)



boxplot(plot.data$Distance~plot.data$Category,
        col = hex(c("navy","firebrick")[unique(as.numeric(plot.data$Genotype))],.5), 
        xlab = "", ylab = "Total distance (mm/5min)",
        las = 2)#,
        #ylim = c(0,50))

beeswarm(plot.data$Distance~plot.data$Category,
       pch = c(21),
       cex = .4,
       method = "center",
       bg = hex(c("navy","firebrick")[unique(as.numeric(plot.data$Genotype))],.5),
       add = T)

```

```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Generation == "G3.1" & 
                                 total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))



plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

if(length(unique(plot.data$TKT)) == 1){
  plot.data = plot.data[order(plot.data$Genotype, decreasing = T),]
plot.data = plot.data[order(plot.data$Age),]
  plot.data$Category = factor(paste0(plot.data$Genotype, ".",plot.data$Age),
                            levels = unique(paste0(plot.data$Genotype, ".",plot.data$Age)))
  plot.data$Genotype = factor(plot.data$Genotype, levels = c("WT", "A4V"))
}

if(length(unique(plot.data$TKT)) == 2){
  plot.data = plot.data[order(plot.data$TKT),]
  plot.data = plot.data[order(plot.data$Genotype, decreasing = T),]

  plot.data = plot.data[order(plot.data$Age),]
  plot.data$Category = factor(paste0(plot.data$Genotype, ".",
                                     plot.data$TKT, ".",
                                     plot.data$Age),
                            levels = unique(paste0(plot.data$Genotype, ".",
                                                   plot.data$TKT, ".",
                                                   plot.data$Age)))
  plot.data$Genotype = paste0(plot.data$Genotype, ".", plot.data$TKT)
  plot.data$Genotype = factor(plot.data$Genotype, levels = unique(plot.data$Genotype))
}

plot.data$Distance = .2*900*(plot.data$Distance/plot.data$Frames)



boxplot(plot.data$Distance~plot.data$Category,
        col = hex(c("navy","gold", 
                    "firebrick","darkgreen")[unique(as.numeric(plot.data$Genotype))],.5), 
        xlab = "", ylab = "Total distance (mm/5min)",
        las = 2)#,
        #ylim = c(0,50))

beeswarm(plot.data$Distance~plot.data$Category,
       pch = c(21),
       cex = .4,
       method = "center",
       bg = hex(c("navy","gold",
                  "firebrick","darkgreen")[unique(as.numeric(plot.data$Genotype))],.5),
       add = T)

```


```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Generation == "G3.1" & 
                                 total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))



plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

if(length(unique(plot.data$TKT)) == 1){
  plot.data = plot.data[order(plot.data$Genotype, decreasing = T),]
plot.data = plot.data[order(plot.data$Age),]
  plot.data$Category = factor(paste0(plot.data$Genotype, ".",plot.data$Age),
                            levels = unique(paste0(plot.data$Genotype, ".",plot.data$Age)))
  plot.data$Genotype = factor(plot.data$Genotype, levels = c("WT", "A4V"))
}

if(length(unique(plot.data$TKT)) == 2){
  plot.data = plot.data[order(plot.data$TKT),]
  plot.data = plot.data[order(plot.data$Genotype, decreasing = T),]

  plot.data = plot.data[order(plot.data$Age),]
  plot.data$Category = factor(paste0(plot.data$Genotype, ".",
                                     plot.data$TKT, ".",
                                     plot.data$Age),
                            levels = unique(paste0(plot.data$Genotype, ".",
                                                   plot.data$TKT, ".",
                                                   plot.data$Age)))
  plot.data$Genotype = paste0(plot.data$Genotype, ".", plot.data$TKT)
  plot.data$Genotype = factor(plot.data$Genotype, levels = unique(plot.data$Genotype))
}

plot.data$Distance = .2*900*(plot.data$Distance/plot.data$Frames)



boxplot(plot.data$Distance~plot.data$Category,
        col = hex(c("navy","gold", 
                    "firebrick","darkgreen")[unique(as.numeric(plot.data$Genotype))],.5), 
        xlab = "", ylab = "Total distance (mm/5min)",
        las = 2)#,
        #ylim = c(0,50))

beeswarm(plot.data$Distance~plot.data$Category,
       pch = c(21),
       cex = .4,
       method = "center",
       bg = hex(c("navy","gold",
                  "firebrick","darkgreen")[unique(as.numeric(plot.data$Genotype))],.5),
       add = T)

```




```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Generation == "G2.1"& 
                                 total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

mean.names = unique(paste0(plot.data$Genotype,".",plot.data$Age))
mean.data = plot.data[,c("Genotype", "Age")]
mean.data$sample = paste0(mean.data$Genotype, ".", mean.data$Age)
mean.data = unique(mean.data)
mean.data$Genotype = factor(mean.data$Genotype, c("WT", "A4V"))
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}

mean.dataM2.1 = mean.data
WTM2.1 = mean.data[mean.data$Genotype == "WT",]
A4VM2.1 = mean.data[mean.data$Genotype == "A4V",]



plot.data = na.omit(total.dist[total.dist$Generation == "G2.2"& 
                                 total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

mean.names = unique(paste0(plot.data$Genotype,".",plot.data$Age))
mean.data = plot.data[,c("Genotype", "Age")]
mean.data$sample = paste0(mean.data$Genotype, ".", mean.data$Age)
mean.data = unique(mean.data)
mean.data$Genotype = factor(mean.data$Genotype, c("WT", "A4V"))
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}

mean.dataM2.2 = mean.data
WTM2.2 = mean.data[mean.data$Genotype == "WT",]
A4VM2.2 = mean.data[mean.data$Genotype == "A4V",]

plot.data = na.omit(total.dist[total.dist$Generation == "G2.3"& 
                                 total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

mean.names = unique(paste0(plot.data$Genotype,".",plot.data$Age))
mean.data = plot.data[,c("Genotype", "Age")]
mean.data$sample = paste0(mean.data$Genotype, ".", mean.data$Age)
mean.data = unique(mean.data)
mean.data$Genotype = factor(mean.data$Genotype, c("WT", "A4V"))
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}

mean.dataM2.3 = mean.data
WTM2.3 = mean.data[mean.data$Genotype == "WT",]
A4VM2.3 = mean.data[mean.data$Genotype == "A4V",]


par(mfrow = c(1,3))
plot(x = WTM2.1$Age,
     y = WTM2.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataM2.1$dist)))

lines(x = A4VM2.1$Age,
     y = A4VM2.1$dist,
     col = "firebrick",
     type = "l")


plot(x = WTM2.2$Age,
     y = WTM2.2$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataM2.2$dist)))

lines(x = A4VM2.2$Age,
     y = A4VM2.2$dist,
     col = "firebrick",
     type = "l")

plot(x = WTM2.3$Age,
     y = WTM2.3$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataM2.3$dist)))

lines(x = A4VM2.3$Age,
     y = A4VM2.3$dist,
     col = "firebrick",
     type = "l")

```

```{r echo = F}
plot.data = na.omit(total.dist[(total.dist$Generation == "G2.1" |
                                 total.dist$Generation == "G2.2" |
                                 total.dist$Generation == "G2.3") & 
                                 total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

mean.names = unique(paste0(plot.data$Genotype,".",plot.data$Age))
mean.data = plot.data[,c("Genotype", "Age")]
mean.data$sample = paste0(mean.data$Genotype, ".", mean.data$Age)
mean.data = unique(mean.data)
mean.data$Genotype = factor(mean.data$Genotype, c("WT", "A4V"))
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}

mean.dataM123 = mean.data
WTM123 = mean.data[mean.data$Genotype == "WT",]
A4VM123 = mean.data[mean.data$Genotype == "A4V",]

plot(x = WTM123$Age,
     y = WTM123$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataM123$dist)))

lines(x = A4VM123$Age,
     y = A4VM123$dist,
     col = "firebrick",
     type = "l")

```


```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Generation == "G3.1" & 
                                 total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

mean.data = plot.data[,c("Genotype", "Age", "TKT")]
mean.data$sample = paste0(plot.data$Genotype,".",
                           plot.data$Age, ".",
                           plot.data$TKT)
mean.data = unique(mean.data)
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  temp = temp[temp$TKT %in% mean.data$TKT[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}
mean.dataM3.1 = mean.data
WTM3.1 = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "Control",]
A4VM3.1 = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "Control",]
WTTKTM3.1 = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "TKT",]
A4VTKTM3.1 = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "TKT",]

plot(x = WTM3.1$Age,
     y = WTM3.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataM3.1$dist)),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VM3.1$Age,
     y = A4VM3.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTM3.1$Age,
     y = WTTKTM3.1$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTM3.1$Age,
     y = A4VTKTM3.1$dist,
     col = "gold",
     type = "l")

```

```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Generation == "G4.1" & 
                                 total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

mean.data = plot.data[,c("Genotype", "Age", "TKT")]
mean.data$sample = paste0(plot.data$Genotype,".",
                           plot.data$Age, ".",
                           plot.data$TKT)
mean.data = unique(mean.data)
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  temp = temp[temp$TKT %in% mean.data$TKT[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}
mean.dataM4.1 = mean.data
WTM4.1 = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "Control",]
A4VM4.1 = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "Control",]
WTTKTM4.1 = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "TKT",]
A4VTKTM4.1 = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "TKT",]

plot(x = WTM4.1$Age,
     y = WTM4.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataM4.1$dist)),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VM4.1$Age,
     y = A4VM4.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTM4.1$Age,
     y = WTTKTM4.1$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTM4.1$Age,
     y = A4VTKTM4.1$dist,
     col = "gold",
     type = "l")

```


```{r echo = F}

plot(x = WTM2.1$Age,
     y = WTM2.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,150),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VM2.1$Age,
     y = A4VM2.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTM2.2$Age,
     y = WTM2.2$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VM2.2$Age,
     y = A4VM2.2$dist,
     col = "firebrick",
     type = "l")

lines(x = WTM2.2$Age,
     y = WTM2.2$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VM2.3$Age,
     y = A4VM2.3$dist,
     col = "firebrick",
     type = "l")

lines(x = WTM3.1$Age,
     y = WTM3.1$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VM3.1$Age,
     y = A4VM3.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTM3.1$Age,
     y = WTTKTM3.1$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTM3.1$Age,
     y = A4VTKTM3.1$dist,
     col = "gold",
     type = "l")

lines(x = WTM4.1$Age,
     y = WTM4.1$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VM4.1$Age,
     y = A4VM4.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTM4.1$Age,
     y = WTTKTM4.1$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTM4.1$Age,
     y = A4VTKTM4.1$dist,
     col = "gold",
     type = "l")

```


```{r echo = F}

plot(x = WTM2.1$Age,
     y = WTM2.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,60),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VM2.1$Age,
     y = A4VM2.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTM2.2$Age,
     y = WTM2.2$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VM2.2$Age,
     y = A4VM2.2$dist,
     col = "firebrick",
     type = "l")

lines(x = WTM2.2$Age,
     y = WTM2.2$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VM2.3$Age,
     y = A4VM2.3$dist,
     col = "firebrick",
     type = "l")

lines(x = WTM3.1$Age,
     y = WTM3.1$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VM3.1$Age,
     y = A4VM3.1$dist,
     col = "firebrick",
     type = "l")


lines(x = WTM4.1$Age,
     y = WTM4.1$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VM4.1$Age,
     y = A4VM4.1$dist,
     col = "firebrick",
     type = "l")


```


```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

Sample = paste0(plot.data$Genotype, ".",
                plot.data$TKT, ".",
                plot.data$Age)

norm.dist = plot.data$Distance/plot.data$Frames

d4.p = t.test(x = norm.dist[Sample == "WT.Control.4"],
              y = norm.dist[Sample == "A4V.Control.4"],
              paired = F)

d5.p = t.test(x = norm.dist[Sample == "WT.Control.5"],
              y = norm.dist[Sample == "A4V.Control.5"],
              paired = F)

d6.p = t.test(x = norm.dist[Sample == "WT.Control.6"],
              y = norm.dist[Sample == "A4V.Control.6"],
              paired = F)

d7.p = t.test(x = norm.dist[Sample == "WT.Control.7"],
              y = norm.dist[Sample == "A4V.Control.7"],
              paired = F)

d8.p = t.test(x = norm.dist[Sample == "WT.Control.8"],
              y = norm.dist[Sample == "A4V.Control.8"],
              paired = F)

d9.p = t.test(x = norm.dist[Sample == "WT.Control.9"],
              y = norm.dist[Sample == "A4V.Control.9"],
              paired = F)

d10.p = t.test(x = norm.dist[Sample == "WT.Control.10"],
              y = norm.dist[Sample == "A4V.Control.10"],
              paired = F)

d11.p = t.test(x = norm.dist[Sample == "WT.Control.11"],
              y = norm.dist[Sample == "A4V.Control.11"],
              paired = F)

mean.data = plot.data[,c("Genotype", "Age", "TKT")]
mean.data$sample = paste0(plot.data$Genotype,".",
                           plot.data$Age, ".",
                           plot.data$TKT)
mean.data = unique(mean.data)
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  temp = temp[temp$TKT %in% mean.data$TKT[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}
mean.dataM = mean.data
WTM = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "Control",]
A4VM = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "Control",]
WTTKTM = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "TKT",]
A4VTKTM = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "TKT",]
par(mar = c(5,4,4,5))
plot(x = WTM$Age,
     y = WTM$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,45),
     xlim = c(3,(max(mean.dataM$Age)+.5)),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VM$Age,
     y = A4VM$dist,
     col = "firebrick",
     type = "l")

points(x = WTM$Age,
       y = WTM$dist,
       bg = "deepskyblue",
       pch = 21)

points(x = A4VM$Age,
       y = A4VM$dist,
       bg = "deeppink",
       pch = 21)

text(x = unique(plot.data$Age),
     y = rep(40, length(unique(plot.data$Age))),
     label = paste0("p = ", c(signif(d4.p[[3]],3),signif(d5.p[[3]],3),
               signif(d6.p[[3]],3),signif(d7.p[[3]],3),
               signif(d8.p[[3]],3),signif(d9.p[[3]],3),
               signif(d10.p[[3]],3),signif(d11.p[[3]],3))),
     cex = .75)


legend('topright',
       inset=c(-0.125,0),
       legend = c("WT",'A4V'), 
       fill = c("royalblue",'firebrick'),
       cex = .65,
       bty = 'n',
       pt.cex = .5,
       xpd = T)


```


```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Sex == "M", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

mean.data = plot.data[,c("Genotype", "Age", "TKT")]
mean.data$sample = paste0(plot.data$Genotype,".",
                           plot.data$Age, ".",
                           plot.data$TKT)
mean.data = unique(mean.data)
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  temp = temp[temp$TKT %in% mean.data$TKT[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}
mean.dataM = mean.data
WTM = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "Control",]
A4VM = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "Control",]
WTTKTM = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "TKT",]
A4VTKTM = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "TKT",]

par(mar = c(5,4,4,5))
plot(x = WTM$Age,
     y = WTM$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataM$dist)),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VM$Age,
     y = A4VM$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTM$Age,
     y = WTTKTM$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTM$Age,
     y = A4VTKTM$dist,
     col = "gold",
     type = "l")

points(x = WTM$Age,
       y = WTM$dist,
       bg = "deepskyblue",
       pch = 21)

points(x = A4VM$Age,
       y = A4VM$dist,
       bg = "deeppink",
       pch = 21)

points(x = WTTKTM$Age,
       y = WTTKTM$dist,
       bg = "limegreen",
       pch = 21)

points(x = A4VTKTM$Age,
       y = A4VTKTM$dist,
       bg = "yellow",
       pch = 21)


legend('topright',
       inset=c(-0.185,0),
       legend = c("WT",'A4V', "WT-TKTdf", "A4V-TKTdf"), 
       fill = c("royalblue",'firebrick', "darkgreen", "gold"),
       cex = .65,
       bty = 'n',
       pt.cex = .5,
       xpd = T)

```


##Females
```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Generation == "G2.1"& 
                                 total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

mean.names = unique(paste0(plot.data$Genotype,".",plot.data$Age))
mean.data = plot.data[,c("Genotype", "Age")]
mean.data$sample = paste0(mean.data$Genotype, ".", mean.data$Age)
mean.data = unique(mean.data)
mean.data$Genotype = factor(mean.data$Genotype, c("WT", "A4V"))
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}

mean.dataF2.1 = mean.data
WTF2.1 = mean.data[mean.data$Genotype == "WT",]
A4VF2.1 = mean.data[mean.data$Genotype == "A4V",]



plot.data = na.omit(total.dist[total.dist$Generation == "G2.2"& 
                                 total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

mean.names = unique(paste0(plot.data$Genotype,".",plot.data$Age))
mean.data = plot.data[,c("Genotype", "Age")]
mean.data$sample = paste0(mean.data$Genotype, ".", mean.data$Age)
mean.data = unique(mean.data)
mean.data$Genotype = factor(mean.data$Genotype, c("WT", "A4V"))
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}

mean.dataF2.2 = mean.data
WTF2.2 = mean.data[mean.data$Genotype == "WT",]
A4VF2.2 = mean.data[mean.data$Genotype == "A4V",]

plot.data = na.omit(total.dist[total.dist$Generation == "G2.3"& 
                                 total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

mean.names = unique(paste0(plot.data$Genotype,".",plot.data$Age))
mean.data = plot.data[,c("Genotype", "Age")]
mean.data$sample = paste0(mean.data$Genotype, ".", mean.data$Age)
mean.data = unique(mean.data)
mean.data$Genotype = factor(mean.data$Genotype, c("WT", "A4V"))
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}

mean.dataF2.3 = mean.data
WTF2.3 = mean.data[mean.data$Genotype == "WT",]
A4VF2.3 = mean.data[mean.data$Genotype == "A4V",]


par(mfrow = c(1,3))
plot(x = WTF2.1$Age,
     y = WTF2.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataF2.1$dist)))

lines(x = A4VF2.1$Age,
     y = A4VF2.1$dist,
     col = "firebrick",
     type = "l")


plot(x = WTF2.2$Age,
     y = WTF2.2$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataF2.2$dist)))

lines(x = A4VF2.2$Age,
     y = A4VF2.2$dist,
     col = "firebrick",
     type = "l")

plot(x = WTF2.3$Age,
     y = WTF2.3$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataF2.3$dist)))

lines(x = A4VF2.3$Age,
     y = A4VF2.3$dist,
     col = "firebrick",
     type = "l")

```

```{r echo = F}
plot.data = na.omit(total.dist[(total.dist$Generation == "G2.1" |
                                 total.dist$Generation == "G2.2" |
                                 total.dist$Generation == "G2.3") & 
                                 total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

mean.names = unique(paste0(plot.data$Genotype,".",plot.data$Age))
mean.data = plot.data[,c("Genotype", "Age")]
mean.data$sample = paste0(mean.data$Genotype, ".", mean.data$Age)
mean.data = unique(mean.data)
mean.data$Genotype = factor(mean.data$Genotype, c("WT", "A4V"))
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}

mean.dataF123 = mean.data
WTF123 = mean.data[mean.data$Genotype == "WT",]
A4VF123 = mean.data[mean.data$Genotype == "A4V",]

plot(x = WTF123$Age,
     y = WTF123$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataF123$dist)))

lines(x = A4VF123$Age,
     y = A4VF123$dist,
     col = "firebrick",
     type = "l")

```


```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Generation == "G3.1" & 
                                 total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

mean.data = plot.data[,c("Genotype", "Age", "TKT")]
mean.data$sample = paste0(plot.data$Genotype,".",
                           plot.data$Age, ".",
                           plot.data$TKT)
mean.data = unique(mean.data)
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  temp = temp[temp$TKT %in% mean.data$TKT[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}
mean.dataF3.1 = mean.data
WTF3.1 = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "Control",]
A4VF3.1 = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "Control",]
WTTKTF3.1 = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "TKT",]
A4VTKTF3.1 = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "TKT",]

plot(x = WTF3.1$Age,
     y = WTF3.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataF3.1$dist)),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VF3.1$Age,
     y = A4VF3.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTF3.1$Age,
     y = WTTKTF3.1$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTF3.1$Age,
     y = A4VTKTF3.1$dist,
     col = "gold",
     type = "l")

```

```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Generation == "G4.1" & 
                                 total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

mean.data = plot.data[,c("Genotype", "Age", "TKT")]
mean.data$sample = paste0(plot.data$Genotype,".",
                           plot.data$Age, ".",
                           plot.data$TKT)
mean.data = unique(mean.data)
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  temp = temp[temp$TKT %in% mean.data$TKT[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}
mean.dataF4.1 = mean.data
WTF4.1 = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "Control",]
A4VF4.1 = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "Control",]
WTTKTF4.1 = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "TKT",]
A4VTKTF4.1 = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "TKT",]

plot(x = WTF4.1$Age,
     y = WTF4.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataF4.1$dist)),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VF4.1$Age,
     y = A4VF4.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTF4.1$Age,
     y = WTTKTF4.1$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTF4.1$Age,
     y = A4VTKTF4.1$dist,
     col = "gold",
     type = "l")

```


```{r echo = F}

plot(x = WTF2.1$Age,
     y = WTF2.1$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,150),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VF2.1$Age,
     y = A4VF2.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTF2.2$Age,
     y = WTF2.2$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VF2.2$Age,
     y = A4VF2.2$dist,
     col = "firebrick",
     type = "l")

lines(x = WTF2.2$Age,
     y = WTF2.2$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VF2.3$Age,
     y = A4VF2.3$dist,
     col = "firebrick",
     type = "l")

lines(x = WTF3.1$Age,
     y = WTF3.1$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VF3.1$Age,
     y = A4VF3.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTF3.1$Age,
     y = WTTKTF3.1$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTF3.1$Age,
     y = A4VTKTF3.1$dist,
     col = "gold",
     type = "l")

lines(x = WTF4.1$Age,
     y = WTF4.1$dist,
     col = "royalblue",
     type = "l")

lines(x = A4VF4.1$Age,
     y = A4VF4.1$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTF4.1$Age,
     y = WTTKTF4.1$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTF4.1$Age,
     y = A4VTKTF4.1$dist,
     col = "gold",
     type = "l")

```



```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

Sample = paste0(plot.data$Genotype, ".",
                plot.data$TKT, ".",
                plot.data$Age)

norm.dist = plot.data$Distance/plot.data$Frames

d4.p = t.test(x = norm.dist[Sample == "WT.Control.4"],
              y = norm.dist[Sample == "A4V.Control.4"],
              paired = F)

d5.p = t.test(x = norm.dist[Sample == "WT.Control.5"],
              y = norm.dist[Sample == "A4V.Control.5"],
              paired = F)

d6.p = t.test(x = norm.dist[Sample == "WT.Control.6"],
              y = norm.dist[Sample == "A4V.Control.6"],
              paired = F)

d7.p = t.test(x = norm.dist[Sample == "WT.Control.7"],
              y = norm.dist[Sample == "A4V.Control.7"],
              paired = F)

d8.p = t.test(x = norm.dist[Sample == "WT.Control.8"],
              y = norm.dist[Sample == "A4V.Control.8"],
              paired = F)

d9.p = t.test(x = norm.dist[Sample == "WT.Control.9"],
              y = norm.dist[Sample == "A4V.Control.9"],
              paired = F)

d10.p = t.test(x = norm.dist[Sample == "WT.Control.10"],
              y = norm.dist[Sample == "A4V.Control.10"],
              paired = F)

d11.p = t.test(x = norm.dist[Sample == "WT.Control.11"],
              y = norm.dist[Sample == "A4V.Control.11"],
              paired = F)

mean.data = plot.data[,c("Genotype", "Age", "TKT")]
mean.data$sample = paste0(plot.data$Genotype,".",
                           plot.data$Age, ".",
                           plot.data$TKT)
mean.data = unique(mean.data)
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  temp = temp[temp$TKT %in% mean.data$TKT[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}
mean.dataF = mean.data
WTF = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "Control",]
A4VF = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "Control",]
WTTKTF = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "TKT",]
A4VTKTF = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "TKT",]

par(mar = c(5,4,4,5))
plot(x = WTF$Age,
     y = WTF$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,65),
     xlim = c(3,(max(mean.dataF$Age)+.5)),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VF$Age,
     y = A4VF$dist,
     col = "firebrick",
     type = "l")

points(x = WTF$Age,
       y = WTF$dist,
       bg = "deepskyblue",
       pch = 21)

points(x = A4VF$Age,
       y = A4VF$dist,
       bg = "deeppink",
       pch = 21)

text(x = unique(plot.data$Age),
     y = rep(60, length(unique(plot.data$Age))),
     label = paste0("p = ", c(signif(d4.p[[3]],3),signif(d5.p[[3]],3),
               signif(d6.p[[3]],3),signif(d7.p[[3]],3),
               signif(d8.p[[3]],3),signif(d9.p[[3]],3),
               signif(d10.p[[3]],3),signif(d11.p[[3]],3))),
     cex = .75)

legend('topright',
       inset=c(-0.125,0),
       legend = c("WT",'A4V'), 
       fill = c("royalblue",'firebrick'),
       cex = .65,
       bty = 'n',
       pt.cex = .5,
       xpd = T)


```



```{r echo = F}

plot.data = na.omit(total.dist[total.dist$Sex == "F", ])
plot.data$Age = as.numeric(substr(plot.data$Age, 2,3))

plot.data$TKT = "Control"
plot.data$TKT[grep("TKT", plot.data$Genotypes)] = "TKT"

mean.data = plot.data[,c("Genotype", "Age", "TKT")]
mean.data$sample = paste0(plot.data$Genotype,".",
                           plot.data$Age, ".",
                           plot.data$TKT)
mean.data = unique(mean.data)
mean.data$dist = 0
i=1
while(i<=nrow(mean.data)){
  temp = plot.data[plot.data$Genotype %in% mean.data$Genotype[i],]
  temp = temp[temp$Age %in% mean.data$Age[i],]
  temp = temp[temp$TKT %in% mean.data$TKT[i],]
  mean.data$dist[i] = .2*900*(mean(temp$Distance)/temp$Frames[1])
  i=i+1
}
mean.dataF = mean.data
WTF = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "Control",]
A4VF = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "Control",]
WTTKTF = mean.data[mean.data$Genotype == "WT" &
                    mean.data$TKT == "TKT",]
A4VTKTF = mean.data[mean.data$Genotype == "A4V" &
                    mean.data$TKT == "TKT",]

par(mar = c(5,4,4,5))
plot(x = WTF$Age,
     y = WTF$dist,
     col = "royalblue",
     type = "l",
     ylim = c(0,max(mean.dataF3.1$dist)),
     xlab = "Age (days)",
     ylab = "Distance Traveled (mm/5min)")

lines(x = A4VF$Age,
     y = A4VF$dist,
     col = "firebrick",
     type = "l")

lines(x = WTTKTF$Age,
     y = WTTKTF$dist,
     col = "darkgreen",
     type = "l")

lines(x = A4VTKTF$Age,
     y = A4VTKTF$dist,
     col = "gold",
     type = "l")


points(x = WTF$Age,
       y = WTF$dist,
       bg = "deepskyblue",
       pch = 21)

points(x = A4VF$Age,
       y = A4VF$dist,
       bg = "deeppink",
       pch = 21)

points(x = WTTKTF$Age,
       y = WTTKTF$dist,
       bg = "limegreen",
       pch = 21)

points(x = A4VTKTF$Age,
       y = A4VTKTF$dist,
       bg = "yellow",
       pch = 21)

legend('topright',
       inset=c(-0.185,0),
       legend = c("WT",'A4V', "WT-TKTdf", "A4V-TKTdf"), 
       fill = c("royalblue",'firebrick', "darkgreen", "gold"),
       cex = .65,
       bty = 'n',
       pt.cex = .5,
       xpd = T)

```

```{r echo = F}

data = df2[df2$TrackID == 24,]

plot(x = data$Frame,
     y = data$disp,
     col = "grey",
     cex = .2,
     type = "l")#,
     #xlim = c(1700,3600))
points(x = data$Frame[data$moving_final == TRUE],
       y = data$disp[data$moving_final == TRUE],
       col = "royalblue",
       cex = .3)
points(x = data$Frame[data$moving_final == FALSE],
       y = data$disp[data$moving_final == FALSE],
       col = "grey",
       cex = .3)

```



```{r echo = F}

suppressPackageStartupMessages({
  library(tidyr)
  library(ggplot2)
  library(slider)
  library(dplyr)
})

# ---------- helpers ----------
wrap_pi <- function(x) atan2(sin(x), cos(x))

# Segment consecutive runs of the same label
segment_runs <- function(df, label_col = "label") {
  lab <- df[[label_col]]
  r <- rle(as.character(lab))
  ends <- cumsum(r$lengths)
  starts <- c(1, head(ends, -1) + 1)
  tibble(
    seg_id = seq_along(r$values),
    label = r$values,
    start_i = starts,
    end_i = ends
  )
}

# ---------- main analysis ----------
analyze_single_track <- function(track_df,
                                 fps,
                                 frame_col = "Frame",
                                 x_col = "CX",
                                 y_col = "CY",
                                 window_s = 0.5,          # sliding window seconds
                                 jitter_px = 1.5,         # below this per-frame step treated as "noise-ish"
                                 still_frac_cut = 0.80,   # if most steps are < jitter_px => still/jitter
                                 lin_eff_cut = 0.70,      # path efficiency high => linear_walk
                                 turn_rate_cut = 2.5,     # rad/s, high turning suggests erratic/flail
                                 flail_speed_hi = 12      # px/frame, very high instantaneous motion
                                 ) {

  stopifnot(all(c(frame_col, x_col, y_col) %in% names(track_df)))
  w <- max(5, round(window_s * fps))  # ensure at least 5 frames

  df <- track_df %>%
    transmute(
      frame = .data[[frame_col]],
      x = as.numeric(.data[[x_col]]),
      y = as.numeric(.data[[y_col]])
    ) %>%
    arrange(frame) %>%
    filter(!is.na(x), !is.na(y)) %>%
    distinct(frame, .keep_all = TRUE)

  # Per-frame kinematics
  df <- df %>%
    mutate(
      dx = x - lag(x),
      dy = y - lag(y),
      step = sqrt(dx^2 + dy^2),                 # px/frame
      speed = step * fps,                       # px/s
      theta = atan2(dy, dx),
      dtheta = wrap_pi(theta - lag(theta)),
      turn_rate = abs(dtheta) * fps,            # rad/s
      accel = (speed - lag(speed)) * fps        # px/s^2 (rough)
    )

  # Window features (computed for each center frame)
  # - net_disp: distance between first and last point in window
  # - path_len: sum of steps in window
  # - eff: net_disp / path_len (path efficiency)
  # - still_frac: fraction of steps < jitter_px
  # - turn_rate_med / turn_rate_mean: turning severity
  # - speed_hi_frac: fraction of steps > flail_speed_hi (px/frame)
  df <- df %>%
    mutate(
      net_disp = slide_dbl(
        .x = row_number(),
        .before = w - 1, .complete = TRUE,
        .f = ~{
          i0 <- min(.x); i1 <- max(.x)
          sqrt((x[i1] - x[i0])^2 + (y[i1] - y[i0])^2)
        }
      ),
      path_len = slide_dbl(step, .before = w - 1, .complete = TRUE, ~sum(.x, na.rm = TRUE)),
      eff = if_else(path_len > 0, net_disp / path_len, NA_real_),
      still_frac = slide_dbl(step, .before = w - 1, .complete = TRUE,
                             ~mean(.x < jitter_px, na.rm = TRUE)),
      turn_rate_med = slide_dbl(turn_rate, .before = w - 1, .complete = TRUE,
                                ~median(.x, na.rm = TRUE)),
      turn_rate_mean = slide_dbl(turn_rate, .before = w - 1, .complete = TRUE,
                                 ~mean(.x, na.rm = TRUE)),
      speed_hi_frac = slide_dbl(step, .before = w - 1, .complete = TRUE,
                                ~mean(.x > flail_speed_hi, na.rm = TRUE))
    )

  # Classification logic (window-based; yields a label per frame)
  # You WILL tune thresholds after comparing to video.
  df <- df %>%
    mutate(
      label = case_when(
        is.na(eff) ~ NA_character_,

        # Mostly below jitter threshold
        still_frac >= still_frac_cut ~ "still/jitter",

        # High efficiency, not too turny => linear walk
        eff >= lin_eff_cut & turn_rate_med < turn_rate_cut ~ "linear_walk",

        # "Flailing": lots of high step frames but low net displacement / low efficiency
        eff < 0.35 & speed_hi_frac >= 0.25 ~ "flailing",

        # Erratic local: low efficiency + high turning
        eff < 0.50 & turn_rate_med >= turn_rate_cut ~ "erratic_local",

        TRUE ~ "other"
      )
    )

  # Segment table for video comparison
  segs <- segment_runs(df, "label") %>%
    dplyr::mutate(
      start_frame = df$frame[start_i],
      end_frame = df$frame[end_i],
      duration_s = (end_frame - start_frame + 1) / fps
    ) %>%
    dplyr::select(seg_id, label, start_frame, end_frame, duration_s) %>%
    dplyr::arrange(start_frame)


  list(
    per_frame = df,
    segments = segs,
    window_frames = w,
    params = list(
      fps = fps, window_s = window_s, jitter_px = jitter_px,
      still_frac_cut = still_frac_cut, lin_eff_cut = lin_eff_cut,
      turn_rate_cut = turn_rate_cut, flail_speed_hi = flail_speed_hi
    )
  )
}

# ---------- plotting ----------
plot_track_diagnostics <- function(res) {
  df <- res$per_frame

  p1 <- ggplot(df, aes(frame, speed)) +
    geom_line(na.rm = TRUE) +
    labs(title = "Speed (px/s)", x = "Frame", y = "Speed") +
    theme_bw()

  p2 <- ggplot(df, aes(frame, eff, color = label)) +
    geom_line(na.rm = TRUE) +
    labs(title = "Path efficiency (net_disp / path_len) with labels",
         x = "Frame", y = "Efficiency") +
    theme_bw()

  p3 <- ggplot(df, aes(x, y, color = label)) +
    geom_path(na.rm = TRUE) +
    coord_equal() +
    labs(title = "Track path colored by label", x = "X", y = "Y") +
    theme_bw()

  list(speed_plot = p1, efficiency_plot = p2, path_plot = p3)
}


  
```


```{r echo = F}

library(dplyr)
library(slider)
library(ggplot2)

segment_runs <- function(df, label_col = "state") {
  lab <- df[[label_col]]
  r <- rle(as.character(lab))
  ends <- cumsum(r$lengths)
  starts <- c(1, head(ends, -1) + 1)
  tibble(
    seg_id = seq_along(r$values),
    state = r$values,
    start_i = starts,
    end_i = ends
  )
}

classify_3state <- function(track_df,
                            fps = 30,
                            fly_len_px = 13,
                            frame_col = "Frame",
                            x_col = "CX",
                            y_col = "CY",
                            win_s = 1.0,               # window length (seconds)
                            walk_net_bl = 0.8,         # walking if net displacement >= this (body lengths per window)
                            flail_wobble_bl = 0.35,    # flailing if wobble >= this but net is low
                            min_seg_s = 0.25           # merge tiny segments shorter than this (seconds)
                            ) {

  w <- max(5, round(win_s * fps))

  df <- track_df %>%
    transmute(
      frame = .data[[frame_col]],
      x = as.numeric(.data[[x_col]]),
      y = as.numeric(.data[[y_col]])
    ) %>%
    arrange(frame) %>%
    filter(!is.na(x), !is.na(y)) %>%
    distinct(frame, .keep_all = TRUE)

  # window features: net displacement & wobble (radius around local mean)
  df <- df %>%
    dplyr::mutate(
      # local mean position
      mx = slide_dbl(x, ~mean(.x, na.rm = TRUE), .before = w-1, .complete = TRUE),
      my = slide_dbl(y, ~mean(.x, na.rm = TRUE), .before = w-1, .complete = TRUE),

      # wobble: average distance from local mean within window
      wobble_px = sqrt((x - mx)^2 + (y - my)^2),

      wobble_win_px = slide_dbl(wobble_px, ~mean(.x, na.rm = TRUE),
                                .before = w-1, .complete = TRUE),

      # net displacement: distance from first to last position in window
      net_win_px = slide_dbl(
        .x = row_number(),
        .before = w-1, .complete = TRUE,
        .f = ~{
          i0 <- min(.x); i1 <- max(.x)
          sqrt((x[i1] - x[i0])^2 + (y[i1] - y[i0])^2)
        }
      ),

      # convert to body lengths for nicer thresholds
      net_win_bl = net_win_px / fly_len_px,
      wobble_win_bl = wobble_win_px / fly_len_px
    ) %>%
    dplyr::mutate(
      state = case_when(
        is.na(net_win_bl) ~ NA_character_,
        net_win_bl >= walk_net_bl ~ "walking",
        net_win_bl < walk_net_bl & wobble_win_bl >= flail_wobble_bl ~ "flailing",
        TRUE ~ "still/jitter"
      )
    )

  # Build segments
  segs <- segment_runs(df, "state") %>%
    dplyr::mutate(
      start_frame = df$frame[start_i],
      end_frame = df$frame[end_i],
      duration_s = (end_frame - start_frame + 1) / fps
    ) %>%
    dplyr::select(seg_id, state, start_frame, end_frame, duration_s)

  # Optional: merge very short segments into neighbors (simple smoothing)
  min_len <- max(1, round(min_seg_s * fps))
  if (nrow(segs) > 2) {
    # mark short segments
    short_ids <- segs$seg_id[segs$duration_s * fps < min_len]
    if (length(short_ids) > 0) {
      # replace short segments' labels with previous label when possible
      df2 <- df %>% dplyr::mutate(state2 = state)
      for (sid in short_ids) {
        s <- segs %>% filter(seg_id == sid)
        i0 <- s$start_frame
        i1 <- s$end_frame
        # indices in df
        idx0 <- which(df$frame == i0)[1]
        idx1 <- which(df$frame == i1)[1]
        if (!is.na(idx0) && !is.na(idx1) && idx0 > 1) {
          df2$state2[idx0:idx1] <- df2$state2[idx0 - 1]
        }
      }
      df <- df2 %>% dplyr::select(-state) %>% dplyr::rename(state = state2)
      segs <- segment_runs(df, "state") %>%
        dplyr::mutate(
          start_frame = df$frame[start_i],
          end_frame = df$frame[end_i],
          duration_s = (end_frame - start_frame + 1) / fps
        ) %>%
        dplyr::select(seg_id, state, start_frame, end_frame, duration_s)
    }
  }

  list(per_frame = df, segments = segs, params = list(
    fps = fps, fly_len_px = fly_len_px, win_s = win_s,
    walk_net_bl = walk_net_bl, flail_wobble_bl = flail_wobble_bl
  ))
}

plot_3state <- function(res) {
  df <- res$per_frame

  p1 <- ggplot(df, aes(frame, net_win_bl, color = state)) +
    geom_line(na.rm = TRUE) +
    theme_bw() +
    labs(y = "Net displacement (body lengths / window)", x = "Frame")

  p2 <- ggplot(df, aes(frame, wobble_win_bl, color = state)) +
    geom_line(na.rm = TRUE) +
    theme_bw() +
    labs(y = "Wobble (body lengths; mean radius)", x = "Frame")

  p3 <- ggplot(df, aes(x, y, color = state)) +
    geom_path(na.rm = TRUE) +
    coord_equal() +
    theme_bw() +
    labs(title = "Path colored by state")

  list(net_plot = p1, wobble_plot = p2, path_plot = p3)
}


```


```{r echo = F}



df <- read.csv(paste0(raw.data.dir, all.files[174]))

one <- df %>% filter(TrackID == 15)

res <- classify_3state(one, fps = 30, fly_len_px = 13,
                       win_s = 1.0,
                       walk_net_bl = 0.5,
                       flail_wobble_bl = 0.15)

res$segments   # this is what you compare to video frames

plots <- plot_3state(res)
plots$net_plot
plots$wobble_plot
plots$path_plot


```



```{r echo = F}



df <- read.csv(paste0(raw.data.dir, all.files[174]))

one <- df %>% filter(TrackID == 23)

res <- classify_3state(one, fps = 30, fly_len_px = 13,
                       win_s = 1.0,
                       walk_net_bl = 0.5,
                       flail_wobble_bl = 0.15)

res$segments   # this is what you compare to video frames

plots <- plot_3state(res)
plots$net_plot
plots$wobble_plot
plots$path_plot


```

```{r echo = F}

library(dplyr)
library(slider)
library(ggplot2)

segment_runs <- function(df, label_col = "state") {
  lab <- df[[label_col]]
  r <- rle(as.character(lab))
  ends <- cumsum(r$lengths)
  starts <- c(1, head(ends, -1) + 1)
  tibble(
    seg_id = seq_along(r$values),
    state = r$values,
    start_i = starts,
    end_i = ends
  )
}

df <- read.csv(paste0(raw.data.dir, all.files[1]))
df <- df %>% filter(TrackID == 15)
fps = 30
fly_len_px = 13
frame_col = "Frame"
x_col = "CX"
y_col = "CY"
win_s = 1.0               # window length (seconds)
walk_net_bl = 0.8         # walking if net displacement >= this (body lengths per window)
flail_wobble_bl = 0.35    # flailing if wobble >= this but net is low
min_seg_s = 0.25           # merge tiny segments shorter than this (seconds)

  w <- max(5, round(win_s * fps))

  df <- track_df %>%
    transmute(
      frame = .data[[frame_col]],
      x = as.numeric(.data[[x_col]]),
      y = as.numeric(.data[[y_col]])
    ) %>%
    arrange(frame) %>%
    filter(!is.na(x), !is.na(y)) %>%
    distinct(frame, .keep_all = TRUE)

  # window features: net displacement & wobble (radius around local mean)
  df <- df %>%
    dplyr::mutate(
      # local mean position
      mx = slide_dbl(x, ~mean(.x, na.rm = TRUE), .before = w-1, .complete = TRUE),
      my = slide_dbl(y, ~mean(.x, na.rm = TRUE), .before = w-1, .complete = TRUE),

      # wobble: average distance from local mean within window
      wobble_px = sqrt((x - mx)^2 + (y - my)^2),

      wobble_win_px = slide_dbl(wobble_px, ~mean(.x, na.rm = TRUE),
                                .before = w-1, .complete = TRUE),

      # net displacement: distance from first to last position in window
      net_win_px = slide_dbl(
        .x = row_number(),
        .before = w-1, .complete = TRUE,
        .f = ~{
          i0 <- min(.x); i1 <- max(.x)
          sqrt((x[i1] - x[i0])^2 + (y[i1] - y[i0])^2)
        }
      ),

      # convert to body lengths for nicer thresholds
      net_win_bl = net_win_px / fly_len_px,
      wobble_win_bl = wobble_win_px / fly_len_px
    ) %>%
    dplyr::mutate(
      state = case_when(
        is.na(net_win_bl) ~ NA_character_,
        net_win_bl >= walk_net_bl ~ "walking",
        net_win_bl < walk_net_bl & wobble_win_bl >= flail_wobble_bl ~ "flailing",
        TRUE ~ "still/jitter"
      )
    )

  # Build segments
  segs <- segment_runs(df, "state") %>%
    dplyr::mutate(
      start_frame = df$frame[start_i],
      end_frame = df$frame[end_i],
      duration_s = (end_frame - start_frame + 1) / fps
    ) %>%
    dplyr::select(seg_id, state, start_frame, end_frame, duration_s)

  # Optional: merge very short segments into neighbors (simple smoothing)
  min_len <- max(1, round(min_seg_s * fps))
  if (nrow(segs) > 2) {
    # mark short segments
    short_ids <- segs$seg_id[segs$duration_s * fps < min_len]
    if (length(short_ids) > 0) {
      # replace short segments' labels with previous label when possible
      df2 <- df %>% dplyr::mutate(state2 = state)
      for (sid in short_ids) {
        s <- segs %>% filter(seg_id == sid)
        i0 <- s$start_frame
        i1 <- s$end_frame
        # indices in df
        idx0 <- which(df$frame == i0)[1]
        idx1 <- which(df$frame == i1)[1]
        if (!is.na(idx0) && !is.na(idx1) && idx0 > 1) {
          df2$state2[idx0:idx1] <- df2$state2[idx0 - 1]
        }
      }
      df <- df2 %>% dplyr::select(-state) %>% dplyr::rename(state = state2)
      segs <- segment_runs(df, "state") %>%
        dplyr::mutate(
          start_frame = df$frame[start_i],
          end_frame = df$frame[end_i],
          duration_s = (end_frame - start_frame + 1) / fps
        ) %>%
        dplyr::select(seg_id, state, start_frame, end_frame, duration_s)
    }
  }

  list(per_frame = df, segments = segs, params = list(
    fps = fps, fly_len_px = fly_len_px, win_s = win_s,
    walk_net_bl = walk_net_bl, flail_wobble_bl = flail_wobble_bl
  ))
}

plot_3state <- function(res) {
  df <- res$per_frame

  p1 <- ggplot(df, aes(frame, net_win_bl, color = state)) +
    geom_line(na.rm = TRUE) +
    theme_bw() +
    labs(y = "Net displacement (body lengths / window)", x = "Frame")

  p2 <- ggplot(df, aes(frame, wobble_win_bl, color = state)) +
    geom_line(na.rm = TRUE) +
    theme_bw() +
    labs(y = "Wobble (body lengths; mean radius)", x = "Frame")

  p3 <- ggplot(df, aes(x, y, color = state)) +
    geom_path(na.rm = TRUE) +
    coord_equal() +
    theme_bw() +
    labs(title = "Path colored by state")

  list(net_plot = p1, wobble_plot = p2, path_plot = p3)
}


```

```{r echo = F}

classify_3state_base <- function(frame, x, y,
                                 fps = 30,
                                 fly_len_px = 8, ##looks closer to 8 for F and M is 7 or 8 
                                 win_s = 1.0,
                                 # thresholds in BODY LENGTHS
                                 walk_net_bl = 0.8,        # net BL per window => walking
                                 flail_tort = 4.0,         # tortuosity >= => flailing (jagged)
                                 flail_wobble_bl = 0.30,   # wobble BL (backup flail criterion)
                                 still_net_bl = 0.15,      # net BL per window <= => candidate still
                                 still_wobble_bl = 0.08    # wobble BL <= => still/jitter
                                 ) {
  # basic cleaning / ordering
  o <- order(frame)
  frame <- frame[o]; x <- x[o]; y <- y[o]
  keep <- is.finite(frame) & is.finite(x) & is.finite(y)
  frame <- frame[keep]; x <- x[keep]; y <- y[keep]

  n <- length(frame)
  w <- max(5, round(win_s * fps))
  eps <- 1e-6

  # per-step
  dx <- c(NA, diff(x))
  dy <- c(NA, diff(y))
  step_px <- sqrt(dx^2 + dy^2) ##frame by frame displacement

  # outputs (one value per frame, aligned to window END)
  net_px <- rep(NA_real_, n) ##actual displacement from first to last frame in window (current frame to current frame -w+1)
  wobble_px <- rep(NA_real_, n) ##average of all the displacement difference per frame from the mean displacement over the window
    ##this strikes me as possibly just variations in velocity
  path_px <- rep(NA_real_, n) ## cumulative displacement of each frame over the window
  tort <- rep(NA_real_, n) ##cumulative displacement/final displacement over window

  # compute window features for each window ending at i
  for (i in w:n) {
    idx <- (i - w + 1):i

    # net displacement
    net_px[i] <- sqrt((x[i] - x[i - w + 1])^2 + (y[i] - y[i - w + 1])^2)

    # path length (sum of steps inside window)
    # steps correspond to transitions, so use step_px[idx] but drop first NA if present
    s <- step_px[idx] ##displacement for each frame in the window
    path_px[i] <- sum(s[is.finite(s)], na.rm = TRUE) ##cumulative displacement

    # wobble = mean radius around window mean position
    mx <- mean(x[idx]) 
    my <- mean(y[idx])
    wobble_px[i] <- mean(sqrt((x[idx] - mx)^2 + (y[idx] - my)^2)) ##average of all the displacement difference per frame from the mean displacement over the window

    tort[i] <- path_px[i] / (net_px[i] + eps)
  }

  # convert to body lengths
  net_bl <- net_px / fly_len_px ##actual displacement over window relative to fly length
  wobble_bl <- wobble_px / fly_len_px ##average displacement difference from mean relative to fly length

  state <- rep(NA_character_, n)

  for (i in w:n) {
    if (!is.finite(net_bl[i]) || !is.finite(wobble_bl[i]) || !is.finite(tort[i])) next

    # walking: big net movement
    if (net_bl[i] >= walk_net_bl) { ##have they displaced far enough over the window to be considered walking?
      state[i] <- "walking"
      next
    }

    # still/jitter: low net AND low wobble
    if (net_bl[i] <= still_net_bl && wobble_bl[i] <= still_wobble_bl) { ##is there displacement less than the displacement cutoff for being still and is their wobble less than the wobble cutoff for flailing
      state[i] <- "still/jitter"
      next
    }

    # flailing: jagged (high tortuosity) OR high wobble while net is modest
    if (tort[i] >= flail_tort || (wobble_bl[i] >= flail_wobble_bl && net_bl[i] < walk_net_bl)) { ##tort is greater than the cutoff indicating they are not actually displacing over the window OR are they wobbling enough to be considered flailing and have not had enough displacement to be considered walking
      state[i] <- "flailing"
      next
    }

    # default: choose based on which it resembles more
    state[i] <- "still/jitter"
  }

  out <- data.frame(
    frame = frame,
    x = x,
    y = y,
    step_px = step_px,
    net_bl = net_bl,
    wobble_bl = wobble_bl,
    tort = tort,
    state = state,
    stringsAsFactors = FALSE
  )

  out
}


```

topleft = 0,0
bottomright = 1080, 1920
good right border - 850
```{r echo = F, fig.height=5, fig.width=5}

df <- read.csv(paste0(raw.data.dir, all.files[174]))

one <- df %>% filter(TrackID == 15)

plot.fly = function(one){
res <- classify_3state_base(one$Frame, one$CX, one$CY,
                            fps = 30, fly_len_px = 8,
                            win_s = 1.0,
                            walk_net_bl = 1.25,
                            flail_tort = 3.0,
                            flail_wobble_bl = 0.20)

##Output for StateOverlayTrackedVideos.py
##write.csv(res[, c("frame","state")], "/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/Fly23.state.csv", row.names = FALSE)



par(mar = c(3,3,4,5))
plot(x = NA,
     y = NA,
     ylim = c(min(res$y), max(res$y)),
     xlim = c(min(res$x), max(res$x)),
     ylab = "",
     xlab = "",
     main = paste0("FlyID: ", one$TrackID[1]))
lines(x = res$x,
      y = res$y,
      type = "l",
      col = "grey")
points(x = res$x[res$state == "flailing"],
       y = res$y[res$state == "flailing"],
       col = "red3",
       cex = .1)
points(x = res$x[res$state == "walking"],
       y = res$y[res$state == "walking"],
       col = "dodgerblue3",
       cex = .1)
points(x = res$x[res$state == "still/jitter"],
       y = res$y[res$state == "still/jitter"],
       col = "green3",
       cex = .1)

legend('topright',
       inset=c(-0.2,0),
       legend = c("flailing", "walking", "still/jitter"), 
       fill = c("red3", "dodgerblue3", "green3"),
       cex = .65,
       bty = 'n',
       pt.cex = .5,
       xpd = T)


if(min(res$y) < 960){
  miny = 0
  maxy = 950
}
if(min(res$y) > 960){
  miny = 950
  maxy = 1920
}

par(mar = c(3,3,4,5))
plot(x = NA,
     y = NA,
     ylim = c(miny, maxy),
     xlim = c(0, 850),
     ylab = "",
     xlab = "",
     main = paste0("FlyID: ", one$TrackID[1]))
lines(x = res$x,
      y = res$y,
      type = "l",
      col = "grey")
points(x = res$x[res$state == "flailing"],
       y = res$y[res$state == "flailing"],
       col = "red3",
       cex = .1)
points(x = res$x[res$state == "walking"],
       y = res$y[res$state == "walking"],
       col = "dodgerblue3",
       cex = .1)
points(x = res$x[res$state == "still/jitter"],
       y = res$y[res$state == "still/jitter"],
       col = "green3",
       cex = .1)

legend('topright',
       inset=c(-0.2,0),
       legend = c("flailing", "walking", "still/jitter"), 
       fill = c("red3", "dodgerblue3", "green3"),
       cex = .65,
       bty = 'n',
       pt.cex = .5,
       xpd = T)

percents = c(length(res$state[res$state == "flailing"]),
             length(res$state[res$state == "walking"]),
             length(res$state[res$state == "still/jitter"]))
pie(percents,
    labels = c("flailing", "walking", "still/jitter"),
    col = c("red3", "dodgerblue3", "green3"))
}
```


```{r echo = F, fig.height=5, fig.width=5}

df <- read.csv(paste0(raw.data.dir, all.files[9]))

one <- df %>% filter(TrackID == 22)

plot.fly(one)

```


```{r echo = F, fig.height=5, fig.width=5}

df <- read.csv(paste0(raw.data.dir, all.files[174]))

one <- df %>% filter(TrackID == 9)

plot.fly(one)

```


```{r echo = F}

i=1

df <- read.csv(paste0(raw.data.dir, all.files[i]))

one <- df %>% filter(TrackID == j)


res <- classify_3state_base(one$Frame, one$CX, one$CY,
                            fps = 30, fly_len_px = 8,
                            win_s = 1.0,
                            walk_net_bl = 1.25,
                            flail_tort = 3.0,
                            flail_wobble_bl = 0.20)

```



```{r echo = F}

df <- read.csv(paste0(raw.data.dir, all.files[174]))
id =1
while(id<=length(unique(df$TrackID))){
one <- df %>% filter(TrackID == id)

#res <- classify_3state(one, fps = 30, fly_len_px = 13,
#                       win_s = 1.0,
#                       walk_net_bl = 0.5,
#                       flail_wobble_bl = 0.15)

res <- classify_3state_base(one$Frame, one$CX, one$CY,
                            fps = 30, fly_len_px = 13,
                            win_s = 1.0,
                            walk_net_bl = 0.8,
                            flail_tort = 4.0,
                            flail_wobble_bl = 0.30)

##Output for StateOverlayTrackedVideos.py
##write.csv(res[, c("frame","state")], "/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/Fly23.state.csv", row.names = FALSE)

#par(mfrow=c(3,1), mar=c(3,4,2,1))
#plot(res$frame, res$net_bl, type="l", xlab="", ylab="Net BL/window")
#plot(res$frame, res$wobble_bl, type="l", xlab="", ylab="Wobble BL")
#plot(res$frame, res$tort, type="l", xlab="Frame", ylab="Tortuosity")


cols <- c("still/jitter"="green3", "walking"="dodgerblue3", "flailing"="red3", "NA"="grey50")
st <- res$state; st[is.na(st)] <- "NA"

plot(res$x, res$y, type="n", xlab="x", ylab="y", asp=1, main=paste0("FlyID: ", id))
for (i in 2:nrow(res)) {
  s <- st[i]
  segments(res$x[i-1], res$y[i-1], res$x[i], res$y[i], col=cols[s])
}
legend("right", legend=names(cols), col=cols, lty=1, bty="n")

percents = c(length(res$state[res$state == "flailing"]),
             length(res$state[res$state == "walking"]),
             length(res$state[res$state == "still/jitter"]))
pie(percents,
    labels = c("flailing", "walking", "still/jitter"),
    col = c("red3", "dodgerblue3", "green3"), main=paste0("FlyID: ", id))
id=id+1
}
```


```{r echo = F}
track_df = read.csv(paste0(raw.data.dir, all.files[1]))
track_df = as.data.frame(track_df[track_df$TrackID == 15,])

temp = analyze_single_track(track_df,
                                 fps = 30,
                                 frame_col = "Frame",
                                 x_col = "CX",
                                 y_col = "CY",
                                 window_s = 0.5,          # sliding window seconds
                                 jitter_px = .6,         # below this per-frame step treated as "noise-ish"
                                 still_frac_cut = 0.85,   # if most steps are < jitter_px => still/jitter
                                 lin_eff_cut = 0.75,      # path efficiency high => linear_walk
                                 turn_rate_cut = 6,     # rad/s, high turning suggests erratic/flail
                                 flail_speed_hi = 2      # px/frame, very high instantaneous motion
                                 ) 

plot_track_diagnostics(temp) 







```

fig = plot_ly(data = f.temp,
              x = ~Frame,
              y = ~distance,
              type = 'scatter',
              mode = 'lines',
              name = ~ObjectID,
              hoverinfo = "text",
              hovertext = paste("Fly ID: ", f.temp$ObjectID,
                                "\nFrame: ", f.temp$Frame,
                                "\ndistance", f.temp$distance))

fig <- fig %>% layout(
        xaxis = list(range = c(0, 20000)),
        yaxis = list(range = c(0, 30000)))

fig

```






```{r echo = F, fig.height=7, fig.width= 7}

temp = read.csv("/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/WTM_x20.M_20251006_V7.csv")

colnames(temp)[2:4] = c("ObjectID", "X", "Y")

title = "WT x20M"

temp$distance = 0

use.frames = c(1, 1:(max(temp$Frame)/10)*10)
temp = temp[temp$Frame %in% use.frames,]

i=1
while(i<=length(unique(temp$ObjectID))){
  temp.distdata = temp[temp$ObjectID == unique(temp$ObjectID)[i],]
  j=2
  while(j<=nrow(temp.distdata)){
    x1 = temp.distdata[temp.distdata$Frame == use.frames[j-1], "X"]
    x2 = temp.distdata[temp.distdata$Frame == use.frames[j], "X"]
    y1 = temp.distdata[temp.distdata$Frame == use.frames[j-1], "Y"]
    y2 = temp.distdata[temp.distdata$Frame == use.frames[j], "Y"]
    deltax = x2-x1
    deltay = y2-y1
    temp[temp$ObjectID == unique(temp$ObjectID)[i] & temp$Frame == use.frames[j], "distance"] =
      sqrt((deltax^2) + (deltay^2)) + 
      temp[temp$ObjectID == unique(temp$ObjectID)[i] & temp$Frame == use.frames[j-1], "distance"]
    j=j+1
  }
  i=i+1
}

m.temp = temp
```


```{r echo = F}
  
fig = plot_ly(data = m.temp,
              x = ~Frame,
              y = ~distance,
              type = 'scatter',
              mode = 'lines',
              name = ~ObjectID,
              hoverinfo = "text",
              hovertext = paste("Fly ID: ", m.temp$ObjectID,
                                "\nFrame: ", m.temp$Frame,
                                "\ndistance", m.temp$distance))
fig <- fig %>% layout(
        xaxis = list(range = c(0, 20000)),
        yaxis = list(range = c(0, 30000)))
fig

```






distance = setNames(rep(0, length(unique(temp$ObjectID))), unique(temp$ObjectID))

temp$Y = 1400 - temp$Y
temp$X = temp$X

x = temp$X
y = temp$Y

temp$X = x
temp$Y = y

i=1
while(i<=length(unique(names(distance)))){
  j = 101
  while(j < max.frame[i]){
    x1 = temp[temp$Frame == j-100 & temp$ObjectID == names(distance)[i], "X"]
    x2 = temp[temp$Frame == j & temp$ObjectID == names(distance)[i], "X"]
    y1 = temp[temp$Frame == j-100 & temp$ObjectID == names(distance)[i], "Y"]
    y2 = temp[temp$Frame == j & temp$ObjectID == names(distance)[i], "Y"]
    distance[i] = distance[i] + sqrt((x2-x1)^2 + (y2-y1)^2)
    j=j+100
  }
  i=i+1
}



speed = distance/max.frame

distance = distance*mm.per.pix["A4VFG1D1"]
speed = speed * speed.conversion["A4VFG1D1"]


A4VFG1D1.dist = distance
A4VFG1D1.speed = speed

par(mar = c(5.35,5.35,5.35,5.35))

plot(NA, 
     type ="n",
     main = title,
     ylim = c(0,1400), xlim = c(0,1400),
     xlab = "",
     ylab = "") #ylim = c(300,600), xlim = c(200,600))#

#rasterImage(bgpic, xleft = 0,
#            xright = 1080,
#            ybottom = 0,
#            ytop = 720)

sample.colors = c("darkorange", "firebrick", "royalblue", 'darkgreen', 'violetred')

i=1
while(i<= length(distance)){
  lines(x = temp$X[temp$ObjectID == names(max.frame)[i]],
     y = temp$Y[temp$ObjectID == names(max.frame)[i]],
     lwd = 1,
     col = sample.colors[i])
  i = i+1
}

legend.text = rep(0, length(distance))
i=1
while(i<= length(distance)){
  legend.text[i] = signif(speed[i],3)
  i = i+1
}

legend(x = 1460,
       y = 1400,
       #legend = c(paste0('1: ', floor(distance[1]), "px"),
       #          paste0('2: ', floor(distance[2]), "px"),
       #           paste0('3: ', floor(distance[3]), "px"),
       #            paste0('4: ', floor(distance[4]), "px"),
       #            paste0('5: ', floor(distance[5]), "px")),
       legend = c(legend.text), 
       fill = sample.colors[1:length(legend.text)],
       cex = 1,
       bty = 'n',
       pt.cex = .5,
       xpd = T,
       title = "mm/s")

```


```{r echo = F, fig.height=7, fig.width= 7}


samplenum = 1
if(samplenum <= length(distance)){
  
par(mar = c(5.35,5.35,5.35,5.35))

plot(NA, 
     type ="n",
     main = title,
     ylim = c(0,1400), xlim = c(0,1400),
     xlab = "",
     ylab = "") #ylim = c(300,600), xlim = c(200,600))#

#rasterImage(bgpic, xleft = 0,
#            xright = 1080,
#            ybottom = 0,
#            ytop = 720)

if(samplenum == 1){
  lines(x = temp$X[temp$ObjectID ==1],
     y = temp$Y[temp$ObjectID ==1],
     lwd = 1,
     col = "darkorange")
}


if(samplenum == 2){
  lines(x = temp$X[temp$ObjectID ==2],
       y = temp$Y[temp$ObjectID ==2],
       lwd = 1,
       col = "firebrick")
}

if(samplenum == 3){
  lines(x = temp$X[temp$ObjectID ==3],
       y = temp$Y[temp$ObjectID ==3],
       lwd = 1,
       col = "royalblue")
}

if(samplenum == 4){
  lines(x = temp$X[temp$ObjectID ==4],
       y = temp$Y[temp$ObjectID ==4],
       lwd = 1,
       col = "darkgreen")
}

if(samplenum == 5){
  lines(x = temp$X[temp$ObjectID ==5],
       y = temp$Y[temp$ObjectID ==5],
       lwd = 1,
       col = "violetred")
}

legend(x = 1460,
       y = 1400,
       #legend = c(paste0('1: ', floor(distance[1]), "px"),
       #          paste0('2: ', floor(distance[2]), "px"),
       #           paste0('3: ', floor(distance[3]), "px"),
       #            paste0('4: ', floor(distance[4]), "px"),
       #            paste0('5: ', floor(distance[5]), "px")),
       legend = c(signif(speed[1],3),
                  signif(speed[2],3),
                  signif(speed[3],3),
                  signif(speed[4],3),
                  signif(speed[5],3))[samplenum], 
       fill = c("darkorange", "firebrick", "royalblue", 'darkgreen', 'violetred')[samplenum],
       cex = 1,
       bty = 'n',
       pt.cex = .5,
       xpd = T,
       title = "mm/s")
}

```


```{r echo = F, fig.height=7, fig.width= 7}


samplenum = 2
if(samplenum <= length(distance)){
  
par(mar = c(5.35,5.35,5.35,5.35))

plot(NA, 
     type ="n",
     main = title,
     ylim = c(0,1400), xlim = c(0,1400),
     xlab = "",
     ylab = "") #ylim = c(300,600), xlim = c(200,600))#

#rasterImage(bgpic, xleft = 0,
#            xright = 1080,
#            ybottom = 0,
#            ytop = 720)

if(samplenum == 1){
  lines(x = temp$X[temp$ObjectID ==1],
     y = temp$Y[temp$ObjectID ==1],
     lwd = 1,
     col = "darkorange")
}


if(samplenum == 2){
  lines(x = temp$X[temp$ObjectID ==2],
       y = temp$Y[temp$ObjectID ==2],
       lwd = 1,
       col = "firebrick")
}

if(samplenum == 3){
  lines(x = temp$X[temp$ObjectID ==3],
       y = temp$Y[temp$ObjectID ==3],
       lwd = 1,
       col = "royalblue")
}

if(samplenum == 4){
  lines(x = temp$X[temp$ObjectID ==4],
       y = temp$Y[temp$ObjectID ==4],
       lwd = 1,
       col = "darkgreen")
}

if(samplenum == 5){
  lines(x = temp$X[temp$ObjectID ==5],
       y = temp$Y[temp$ObjectID ==5],
       lwd = 1,
       col = "violetred")
}

legend(x = 1460,
       y = 1400,
       #legend = c(paste0('1: ', floor(distance[1]), "px"),
       #          paste0('2: ', floor(distance[2]), "px"),
       #           paste0('3: ', floor(distance[3]), "px"),
       #            paste0('4: ', floor(distance[4]), "px"),
       #            paste0('5: ', floor(distance[5]), "px")),
       legend = c(signif(speed[1],3),
                  signif(speed[2],3),
                  signif(speed[3],3),
                  signif(speed[4],3),
                  signif(speed[5],3))[samplenum], 
       fill = c("darkorange", "firebrick", "royalblue", 'darkgreen', 'violetred')[samplenum],
       cex = 1,
       bty = 'n',
       pt.cex = .5,
       xpd = T,
       title = "mm/s")
}

```


```{r echo = F, fig.height=7, fig.width= 7}


samplenum = 3
if(samplenum <= length(distance)){
  
par(mar = c(5.35,5.35,5.35,5.35))

plot(NA, 
     type ="n",
     main = title,
     ylim = c(0,1400), xlim = c(0,1400),
     xlab = "",
     ylab = "") #ylim = c(300,600), xlim = c(200,600))#

#rasterImage(bgpic, xleft = 0,
#            xright = 1080,
#            ybottom = 0,
#            ytop = 720)

if(samplenum == 1){
  lines(x = temp$X[temp$ObjectID ==1],
     y = temp$Y[temp$ObjectID ==1],
     lwd = 1,
     col = "darkorange")
}


if(samplenum == 2){
  lines(x = temp$X[temp$ObjectID ==2],
       y = temp$Y[temp$ObjectID ==2],
       lwd = 1,
       col = "firebrick")
}

if(samplenum == 3){
  lines(x = temp$X[temp$ObjectID ==3],
       y = temp$Y[temp$ObjectID ==3],
       lwd = 1,
       col = "royalblue")
}

if(samplenum == 4){
  lines(x = temp$X[temp$ObjectID ==4],
       y = temp$Y[temp$ObjectID ==4],
       lwd = 1,
       col = "darkgreen")
}

if(samplenum == 5){
  lines(x = temp$X[temp$ObjectID ==5],
       y = temp$Y[temp$ObjectID ==5],
       lwd = 1,
       col = "violetred")
}

legend(x = 1460,
       y = 1400,
       #legend = c(paste0('1: ', floor(distance[1]), "px"),
       #          paste0('2: ', floor(distance[2]), "px"),
       #           paste0('3: ', floor(distance[3]), "px"),
       #            paste0('4: ', floor(distance[4]), "px"),
       #            paste0('5: ', floor(distance[5]), "px")),
       legend = c(signif(speed[1],3),
                  signif(speed[2],3),
                  signif(speed[3],3),
                  signif(speed[4],3),
                  signif(speed[5],3))[samplenum], 
       fill = c("darkorange", "firebrick", "royalblue", 'darkgreen', 'violetred')[samplenum],
       cex = 1,
       bty = 'n',
       pt.cex = .5,
       xpd = T,
       title = "mm/s")
}

```


```{r echo = F, fig.height=7, fig.width= 7}


samplenum = 4
if(samplenum <= length(distance)){
  
par(mar = c(5.35,5.35,5.35,5.35))

plot(NA, 
     type ="n",
     main = title,
     ylim = c(0,1400), xlim = c(0,1400),
     xlab = "",
     ylab = "") #ylim = c(300,600), xlim = c(200,600))#

#rasterImage(bgpic, xleft = 0,
#            xright = 1080,
#            ybottom = 0,
#            ytop = 720)

if(samplenum == 1){
  lines(x = temp$X[temp$ObjectID ==1],
     y = temp$Y[temp$ObjectID ==1],
     lwd = 1,
     col = "darkorange")
}


if(samplenum == 2){
  lines(x = temp$X[temp$ObjectID ==2],
       y = temp$Y[temp$ObjectID ==2],
       lwd = 1,
       col = "firebrick")
}

if(samplenum == 3){
  lines(x = temp$X[temp$ObjectID ==3],
       y = temp$Y[temp$ObjectID ==3],
       lwd = 1,
       col = "royalblue")
}

if(samplenum == 4){
  lines(x = temp$X[temp$ObjectID ==4],
       y = temp$Y[temp$ObjectID ==4],
       lwd = 1,
       col = "darkgreen")
}

if(samplenum == 5){
  lines(x = temp$X[temp$ObjectID ==5],
       y = temp$Y[temp$ObjectID ==5],
       lwd = 1,
       col = "violetred")
}

legend(x = 1460,
       y = 1400,
       #legend = c(paste0('1: ', floor(distance[1]), "px"),
       #          paste0('2: ', floor(distance[2]), "px"),
       #           paste0('3: ', floor(distance[3]), "px"),
       #            paste0('4: ', floor(distance[4]), "px"),
       #            paste0('5: ', floor(distance[5]), "px")),
       legend = c(signif(speed[1],3),
                  signif(speed[2],3),
                  signif(speed[3],3),
                  signif(speed[4],3),
                  signif(speed[5],3))[samplenum], 
       fill = c("darkorange", "firebrick", "royalblue", 'darkgreen', 'violetred')[samplenum],
       cex = 1,
       bty = 'n',
       pt.cex = .5,
       xpd = T,
       title = "mm/s")
}

```


```{r echo = F, fig.height=7, fig.width= 7}


samplenum = 5
if(samplenum <= length(distance)){
  
par(mar = c(5.35,5.35,5.35,5.35))

plot(NA, 
     type ="n",
     main = title,
     ylim = c(0,1400), xlim = c(0,1400),
     xlab = "",
     ylab = "") #ylim = c(300,600), xlim = c(200,600))#

#rasterImage(bgpic, xleft = 0,
#            xright = 1080,
#            ybottom = 0,
#            ytop = 720)

if(samplenum == 1){
  lines(x = temp$X[temp$ObjectID ==1],
     y = temp$Y[temp$ObjectID ==1],
     lwd = 1,
     col = "darkorange")
}


if(samplenum == 2){
  lines(x = temp$X[temp$ObjectID ==2],
       y = temp$Y[temp$ObjectID ==2],
       lwd = 1,
       col = "firebrick")
}

if(samplenum == 3){
  lines(x = temp$X[temp$ObjectID ==3],
       y = temp$Y[temp$ObjectID ==3],
       lwd = 1,
       col = "royalblue")
}

if(samplenum == 4){
  lines(x = temp$X[temp$ObjectID ==4],
       y = temp$Y[temp$ObjectID ==4],
       lwd = 1,
       col = "darkgreen")
}

if(samplenum == 5){
  lines(x = temp$X[temp$ObjectID ==5],
       y = temp$Y[temp$ObjectID ==5],
       lwd = 1,
       col = "violetred")
}

legend(x = 1460,
       y = 1400,
       #legend = c(paste0('1: ', floor(distance[1]), "px"),
       #          paste0('2: ', floor(distance[2]), "px"),
       #           paste0('3: ', floor(distance[3]), "px"),
       #            paste0('4: ', floor(distance[4]), "px"),
       #            paste0('5: ', floor(distance[5]), "px")),
       legend = c(signif(speed[1],3),
                  signif(speed[2],3),
                  signif(speed[3],3),
                  signif(speed[4],3),
                  signif(speed[5],3))[samplenum], 
       fill = c("darkorange", "firebrick", "royalblue", 'darkgreen', 'violetred')[samplenum],
       cex = 1,
       bty = 'n',
       pt.cex = .5,
       xpd = T,
       title = "mm/s")
}

```


```{r echo = F, fig.height=7, fig.width= 7}


frame.distance = data.frame(Rep = character(),
                            frame = numeric(),
                            distance = numeric())

i = 1
while(i <= length(distance)){
  temp.frame.distance = data.frame(Rep = c(rep(names(max.frame[i]), ((floor(max.frame[i]/100))))),
                                   frame = c(100*(1:floor(max.frame[i]/100)-1)),
                                   distance = 0)
  
  frame.distance = rbind(frame.distance, temp.frame.distance)
  i = i+1
}



i=1
while(i<=length(unique(names(distance)))){
  temp.distance = 0
  j = 200
  while(j-100 < max.frame[i]){
    x1 = temp[temp$Frame == j-100 & temp$ObjectID == names(distance)[i], "X"]
    x2 = temp[temp$Frame == j & temp$ObjectID == names(distance)[i], "X"]
    y1 = temp[temp$Frame == j-100 & temp$ObjectID == names(distance)[i], "Y"]
    y2 = temp[temp$Frame == j & temp$ObjectID == names(distance)[i], "Y"]
    temp.distance = temp.distance + sqrt((x2-x1)^2 + (y2-y1)^2)
    frame.distance[frame.distance$Rep == names(distance)[i] &
                     frame.distance$frame == j-100, "distance"]= temp.distance
    j=j+100
  }
  i=i+1
}

frame.distance$distance = frame.distance$distance*mm.per.pix["A4VFG1D1"]

par(mar = c(5.35,5.35,5.35,5.35))

plot(NA, 
     type ="n",
     main = title,
     ylim = c(0,3500), xlim = c(0,9800),
     xlab = "Frame",
     ylab = "Distance (mm)")

i=1
while(i<=length(unique(names(distance)))){
  lines(x = frame.distance$frame[frame.distance$Rep ==names(max.frame[i])],
     y = frame.distance$distance[frame.distance$Rep ==names(max.frame[i])],
     lwd = 1,
     col = sample.colors[i])
  i = i+1
}

       
legend.text = rep(0, length(distance))
i=1
while(i<= length(distance)){
  legend.text[i] = signif(speed[i],3)
  i = i+1
}

legend(x = 10000,
       y = 3500,
       #legend = c(paste0('1: ', floor(distance[1]), "px"),
       #          paste0('2: ', floor(distance[2]), "px"),
       #           paste0('3: ', floor(distance[3]), "px"),
       #            paste0('4: ', floor(distance[4]), "px"),
       #            paste0('5: ', floor(distance[5]), "px")),
       legend = c(legend.text), 
       fill = sample.colors[1:length(legend.text)],
       cex = 1,
       bty = 'n',
       pt.cex = .5,
       xpd = T,
       title = "mm/s")


```


````{r echo = F, fig.width= 10, fig.height= 7}

all.data = data.frame(Genotype = c(rep("A4VF D1", length(A4VFG1D1.dist))),
                      Speed = c(A4VFG1D1.speed),
                      Distance = c(A4VFG1D1.dist))

all.data$Genotype = factor(all.data$Genotype, levels = c("A4VF D1"))

hex = function(color, alpha){
  rgb2hex = color
  i = 1
  while(i <= length(color)){
    rgbvals = col2rgb(color[i])
    rgb2hex[i] = rgb(rgbvals[1]/255, rgbvals[2]/255, rgbvals[3]/255, alpha)
    i = i+1
  }
  return(rgb2hex)
}


boxplot(all.data$Speed~all.data$Genotype,
        col = hex(c("navy","firebrick","darkgreen")[unique(as.numeric(all.data$Genotype))],.5), 
        xlab = "", ylab = "Speed (mm/s)",
        ylim = c(0, 10))

beeswarm(all.data$Speed~all.data$Genotype,
       pch = c(21),
       cex = 2,
       method = "center",
       bg = hex(c("dodgerblue","brown","green")[unique(as.numeric(all.data$Genotype))],1),
       add = T)
````1


```{r echo = F}


t.data = list("TauWTD1" = TauWTD1.speed,
              "TauWTD14" = c(TauWTD14.speed,NA),
              "TauR406WD1" = TauR406WD1.speed,
              "TauR406WD14" = TauR406WD14.speed,
              "LacZD1" = LacZD1.speed,
              "LacZD14" = LacZD14.speed)

t.table = data.frame(Genotype1 = character(),
                     Genotype2 = character(),
                     pval = numeric())

i=1
while(i <= length(t.data)){
  j = i+1
  while(j <= length(t.data)){
    t.temp = data.frame(Genotype1 = names(t.data)[i],
                        Genotype2 = names(t.data)[j],
                        pval = t.test(x = t.data[[i]],
                                      y = t.data[[j]],
                                      paired = F)[[3]])
    t.table = rbind(t.table, t.temp)
      j = j+1
  }
  i = i+1
}


t.stripe = t.table$pval <= .05
knitr::kable(t.table,
             caption = 'All t-tests Tau Activity')  %>%
kable_styling() %>%
row_spec(c(1:nrow(t.table))[t.table$pval <= .05], bold = T, color = "black", background = "gold")

```




```{r echo = F}
library(plotly)


vials = read.csv("/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/20250710_V1.csv")
vials$VialID = vials$VialID +1
colnames(vials)[3:4] = c("X","Y")

vials$lty = rep(c(1,2), 4)[vials$VialID]
vials$shape = rep(c(23,24),4)[vials$VialID]

vials$geno = c("A4V.F", "A4V.F", "A4V.M", "A4V.M", "WT.F", "WT.F", "WT.M", "WT.M")[vials$VialID]

plot.frames = c(1, c(1:floor(max(vials$Frame)/100))*100)
plot.data = vials[vials$Frame %in% plot.frames,]

frame.range = as.list(rep(0, length(unique(plot.data$TrackID))))
names(frame.range) = unique(plot.data$TrackID)
for(i in 1:length(frame.range)){
  frame.range[[i]] = plot.data[plot.data$TrackID == i, "Frame"]
}




#frame.range[[13]] = frame.range[[13]][1:81]





geno.color = c("firebrick", "royalblue", "darkgreen", "goldenrod")


temp = plot.data[plot.data$TrackID == names(frame.range)[1],]
temp = temp[temp$Frame %in% frame.range[[1]],]


i=2
while(i<=length(frame.range)){
  temp2 = plot.data[plot.data$TrackID == names(frame.range)[i],]
  temp2 = temp2[temp2$Frame %in% frame.range[[i]],]
  temp = rbind(temp, temp2)
  i=i+1
}


plot.data = temp

plot.data$distance = 0

j=1
while(j<=max(plot.data$TrackID)){
  i=2
  while(i <= length(frame.range[[j]])){
  
    x1 = plot.data$X[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    x0 = plot.data$X[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    y1 = plot.data$Y[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    y0 = plot.data$Y[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    dist = sqrt(((x1-x0)^2)+((y1-y0)^2))
    
    plot.data$distance[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j] = plot.data$distance[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j] + dist
    i=i+1
  }
  j=j+1
}

full.plot.data = plot.data

j=1
temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))
  fig1 = fig
  
  j=j+1
  

temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig2 = fig
  
  j=j+1
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig3 = fig
  
  j=j+1
  
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig4 = fig
  
  j=j+1
  
  
  fig <- subplot(fig1, fig2, fig3, fig4, nrows = 2)
  
  annotations = list(list(text = unique(plot.data$geno)[1],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[2],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[3],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 0.4),
                    list(text = unique(plot.data$geno)[4],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 0.4))
  
fig <- fig %>%layout(annotations = annotations) 
  
fig <- fig %>% layout(showlegend = FALSE)
  
fig <- fig %>% layout(
  xaxis = list(range = c(0, max(plot.frames))),
  yaxis = list(range = c(0, max(plot.data$distance))),
  xaxis2 = list(range = c(0, max(plot.frames))),
  yaxis2 = list(range = c(0, max(plot.data$distance))),
  xaxis3 = list(range = c(0, max(plot.frames))),
  yaxis3 = list(range = c(0, max(plot.data$distance))),
  xaxis4 = list(range = c(0, max(plot.frames))),
  yaxis4 = list(range = c(0, max(plot.data$distance)))
)
  
  fig
```


```{r echo = F, fig.height=6}

max.frame = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  max.frame[i] = max(frame.range[[i]])
}

num.frames = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  num.frames[i] = length(frame.range[[i]])
}

num.frames = (num.frames -1)*100

total.dist = plot.data
total.dist$last.frame = paste0(total.dist$TrackID,"_",total.dist$Frame)
total.dist = total.dist[total.dist$last.frame %in% paste0(names(max.frame),"_",max.frame),]
row.names(total.dist) = total.dist$TrackID
total.dist$velocity = total.dist$distance/num.frames[row.names(total.dist)]

total.dist$geno = factor(total.dist$geno, unique(total.dist$geno))

par(mar=c(11.25, 4.1, 4.1, 2))


boxplot(total.dist$velocity~total.dist$geno,
        xaxt = 'none',
        xlab = NA,
        col = hex(geno.color, .25),
        ylab = "distance",
        main = "genotype",
        ylim = c(0,max(total.dist$velocity)))

beeswarm(total.dist$velocity~as.numeric(total.dist$geno),
       pch = 21,
       cex = 1.5,
       spacing = 1.5,
       method = "swarm",
       bg = geno.color,
       add = T)


axis(side = 1,
     at = c(1:4),
     labels = c(unique(total.dist$geno)),
     cex = .75,
     las = 2,
     lwd = 0,
     line = -.75)


g3d2=total.dist
```




```{r echo = F}

vials = read.csv("/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/20250711_V1.csv")
vials$VialID = vials$VialID +1
colnames(vials)[3:4] = c("X","Y")

vials$lty = rep(c(1,2), 4)[vials$VialID]
vials$shape = rep(c(23,24),4)[vials$VialID]

vials$geno = c("A4V.F", "A4V.F", "A4V.M", "A4V.M", "WT.F", "WT.F", "WT.M", "WT.M")[vials$VialID]

plot.frames = c(1, c(1:floor(max(vials$Frame)/100))*100)
plot.data = vials[vials$Frame %in% plot.frames,]

frame.range = as.list(rep(0, length(unique(plot.data$TrackID))))
names(frame.range) = unique(plot.data$TrackID)
for(i in 1:length(frame.range)){
  frame.range[[i]] = plot.data[plot.data$TrackID == i, "Frame"]
}




#frame.range[[13]] = frame.range[[13]][1:81]





geno.color = c("firebrick", "royalblue", "darkgreen", "goldenrod")


temp = plot.data[plot.data$TrackID == names(frame.range)[1],]
temp = temp[temp$Frame %in% frame.range[[1]],]


i=2
while(i<=length(frame.range)){
  temp2 = plot.data[plot.data$TrackID == names(frame.range)[i],]
  temp2 = temp2[temp2$Frame %in% frame.range[[i]],]
  temp = rbind(temp, temp2)
  i=i+1
}


plot.data = temp

plot.data$distance = 0

j=1
while(j<=max(plot.data$TrackID)){
  i=2
  while(i <= length(frame.range[[j]])){
  
    x1 = plot.data$X[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    x0 = plot.data$X[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    y1 = plot.data$Y[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    y0 = plot.data$Y[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    dist = sqrt(((x1-x0)^2)+((y1-y0)^2))
    
    plot.data$distance[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j] = plot.data$distance[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j] + dist
    i=i+1
  }
  j=j+1
}

full.plot.data = plot.data

j=1
temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))
  fig1 = fig
  
  j=j+1
  

temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig2 = fig
  
  j=j+1
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig3 = fig
  
  j=j+1
  
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig4 = fig
  
  j=j+1
  
  
  fig <- subplot(fig1, fig2, fig3, fig4, nrows = 2)
  
  annotations = list(list(text = unique(plot.data$geno)[1],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[2],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[3],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 0.4),
                    list(text = unique(plot.data$geno)[4],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 0.4))
  
fig <- fig %>%layout(annotations = annotations) 
  
fig <- fig %>% layout(showlegend = FALSE)
  
fig <- fig %>% layout(
  xaxis = list(range = c(0, max(plot.frames))),
  yaxis = list(range = c(0, max(plot.data$distance))),
  xaxis2 = list(range = c(0, max(plot.frames))),
  yaxis2 = list(range = c(0, max(plot.data$distance))),
  xaxis3 = list(range = c(0, max(plot.frames))),
  yaxis3 = list(range = c(0, max(plot.data$distance))),
  xaxis4 = list(range = c(0, max(plot.frames))),
  yaxis4 = list(range = c(0, max(plot.data$distance)))
)
  
  fig
```


```{r echo = F, fig.height=6}

max.frame = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  max.frame[i] = max(frame.range[[i]])
}

num.frames = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  num.frames[i] = length(frame.range[[i]])
}

num.frames = (num.frames -1)*100

total.dist = plot.data
total.dist$last.frame = paste0(total.dist$TrackID,"_",total.dist$Frame)
total.dist = total.dist[total.dist$last.frame %in% paste0(names(max.frame),"_",max.frame),]
row.names(total.dist) = total.dist$TrackID
total.dist$velocity = total.dist$distance/num.frames[row.names(total.dist)]

total.dist$geno = factor(total.dist$geno, unique(total.dist$geno))

par(mar=c(11.25, 4.1, 4.1, 2))


boxplot(total.dist$velocity~total.dist$geno,
        xaxt = 'none',
        xlab = NA,
        col = hex(geno.color, .25),
        ylab = "distance",
        main = "genotype",
        ylim = c(0,max(total.dist$velocity)))

beeswarm(total.dist$velocity~as.numeric(total.dist$geno),
       pch = 21,
       cex = 1.5,
       spacing = 1.5,
       method = "swarm",
       bg = geno.color,
       add = T)


axis(side = 1,
     at = c(1:4),
     labels = c(unique(total.dist$geno)),
     cex = .75,
     las = 2,
     lwd = 0,
     line = -.75)

g3d3=total.dist

```





```{r echo = F}

vials = read.csv("/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/20250715_V1.csv")
vials$VialID = vials$VialID +1
colnames(vials)[3:4] = c("X","Y")

vials$lty = rep(c(1,2), 4)[vials$VialID]
vials$shape = rep(c(23,24),4)[vials$VialID]

vials$geno = c("A4V.F", "A4V.F", "A4V.M", "A4V.M", "WT.F", "WT.F", "WT.M", "WT.M")[vials$VialID]

plot.frames = c(1, c(1:floor(max(vials$Frame)/100))*100)
plot.data = vials[vials$Frame %in% plot.frames,]

frame.range = as.list(rep(0, length(unique(plot.data$TrackID))))
names(frame.range) = unique(plot.data$TrackID)
for(i in 1:length(frame.range)){
  frame.range[[i]] = plot.data[plot.data$TrackID == i, "Frame"]
}




#frame.range[[13]] = frame.range[[13]][1:81]





geno.color = c("firebrick", "royalblue", "darkgreen", "goldenrod")


temp = plot.data[plot.data$TrackID == names(frame.range)[1],]
temp = temp[temp$Frame %in% frame.range[[1]],]


i=2
while(i<=length(frame.range)){
  temp2 = plot.data[plot.data$TrackID == names(frame.range)[i],]
  temp2 = temp2[temp2$Frame %in% frame.range[[i]],]
  temp = rbind(temp, temp2)
  i=i+1
}


plot.data = temp

plot.data$distance = 0

j=1
while(j<=max(plot.data$TrackID)){
  i=2
  while(i <= length(frame.range[[j]])){
  
    x1 = plot.data$X[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    x0 = plot.data$X[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    y1 = plot.data$Y[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    y0 = plot.data$Y[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    dist = sqrt(((x1-x0)^2)+((y1-y0)^2))
    
    plot.data$distance[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j] = plot.data$distance[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j] + dist
    i=i+1
  }
  j=j+1
}

full.plot.data = plot.data

j=1
temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))
  fig1 = fig
  
  j=j+1
  

temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig2 = fig
  
  j=j+1
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig3 = fig
  
  j=j+1
  
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig4 = fig
  
  j=j+1
  
  
  fig <- subplot(fig1, fig2, fig3, fig4, nrows = 2)
  
  annotations = list(list(text = unique(plot.data$geno)[1],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[2],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[3],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 0.4),
                    list(text = unique(plot.data$geno)[4],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 0.4))
  
fig <- fig %>%layout(annotations = annotations) 
  
fig <- fig %>% layout(showlegend = FALSE)
  
fig <- fig %>% layout(
  xaxis = list(range = c(0, max(plot.frames))),
  yaxis = list(range = c(0, max(plot.data$distance))),
  xaxis2 = list(range = c(0, max(plot.frames))),
  yaxis2 = list(range = c(0, max(plot.data$distance))),
  xaxis3 = list(range = c(0, max(plot.frames))),
  yaxis3 = list(range = c(0, max(plot.data$distance))),
  xaxis4 = list(range = c(0, max(plot.frames))),
  yaxis4 = list(range = c(0, max(plot.data$distance)))
)
  
  fig
```


```{r echo = F, fig.height=6}

max.frame = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  max.frame[i] = max(frame.range[[i]])
}

num.frames = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  num.frames[i] = length(frame.range[[i]])
}

num.frames = (num.frames -1)*100

total.dist = plot.data
total.dist$last.frame = paste0(total.dist$TrackID,"_",total.dist$Frame)
total.dist = total.dist[total.dist$last.frame %in% paste0(names(max.frame),"_",max.frame),]
row.names(total.dist) = total.dist$TrackID
total.dist$velocity = total.dist$distance/num.frames[row.names(total.dist)]

total.dist$geno = factor(total.dist$geno, unique(total.dist$geno))

par(mar=c(11.25, 4.1, 4.1, 2))


boxplot(total.dist$velocity~total.dist$geno,
        xaxt = 'none',
        xlab = NA,
        col = hex(geno.color, .25),
        ylab = "distance",
        main = "genotype",
        ylim = c(0,max(total.dist$velocity)))

beeswarm(total.dist$velocity~as.numeric(total.dist$geno),
       pch = 21,
       cex = 1.5,
       spacing = 1.5,
       method = "swarm",
       bg = geno.color,
       add = T)


axis(side = 1,
     at = c(1:4),
     labels = c(unique(total.dist$geno)),
     cex = .75,
     las = 2,
     lwd = 0,
     line = -.75)

g3d7=total.dist

```





```{r echo = F}

vials = read.csv("/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/20250716_V1.csv")
vials$VialID = vials$VialID +1
colnames(vials)[3:4] = c("X","Y")

vials$lty = rep(c(1,2), 4)[vials$VialID]
vials$shape = rep(c(23,24),4)[vials$VialID]

vials$geno = c("A4V.F", "A4V.F", "A4V.M", "A4V.M", "WT.F", "WT.F", "WT.M", "WT.M")[vials$VialID]

plot.frames = c(1, c(1:floor(max(vials$Frame)/100))*100)
plot.data = vials[vials$Frame %in% plot.frames,]

frame.range = as.list(rep(0, length(unique(plot.data$TrackID))))
names(frame.range) = unique(plot.data$TrackID)
for(i in 1:length(frame.range)){
  frame.range[[i]] = plot.data[plot.data$TrackID == i, "Frame"]
}




#frame.range[[13]] = frame.range[[13]][1:81]





geno.color = c("firebrick", "royalblue", "darkgreen", "goldenrod")


temp = plot.data[plot.data$TrackID == names(frame.range)[1],]
temp = temp[temp$Frame %in% frame.range[[1]],]


i=2
while(i<=length(frame.range)){
  temp2 = plot.data[plot.data$TrackID == names(frame.range)[i],]
  temp2 = temp2[temp2$Frame %in% frame.range[[i]],]
  temp = rbind(temp, temp2)
  i=i+1
}


plot.data = temp

plot.data$distance = 0

j=1
while(j<=max(plot.data$TrackID)){
  i=2
  while(i <= length(frame.range[[j]])){
  
    x1 = plot.data$X[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    x0 = plot.data$X[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    y1 = plot.data$Y[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    y0 = plot.data$Y[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    dist = sqrt(((x1-x0)^2)+((y1-y0)^2))
    
    plot.data$distance[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j] = plot.data$distance[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j] + dist
    i=i+1
  }
  j=j+1
}

full.plot.data = plot.data

j=1
temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))
  fig1 = fig
  
  j=j+1
  

temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig2 = fig
  
  j=j+1
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig3 = fig
  
  j=j+1
  
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig4 = fig
  
  j=j+1
  
  
  fig <- subplot(fig1, fig2, fig3, fig4, nrows = 2)
  
  annotations = list(list(text = unique(plot.data$geno)[1],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[2],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[3],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 0.4),
                    list(text = unique(plot.data$geno)[4],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 0.4))
  
fig <- fig %>%layout(annotations = annotations) 
  
fig <- fig %>% layout(showlegend = FALSE)
  
fig <- fig %>% layout(
  xaxis = list(range = c(0, max(plot.frames))),
  yaxis = list(range = c(0, max(plot.data$distance))),
  xaxis2 = list(range = c(0, max(plot.frames))),
  yaxis2 = list(range = c(0, max(plot.data$distance))),
  xaxis3 = list(range = c(0, max(plot.frames))),
  yaxis3 = list(range = c(0, max(plot.data$distance))),
  xaxis4 = list(range = c(0, max(plot.frames))),
  yaxis4 = list(range = c(0, max(plot.data$distance)))
)
  
  fig
```


```{r echo = F, fig.height=6}

max.frame = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  max.frame[i] = max(frame.range[[i]])
}

num.frames = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  num.frames[i] = length(frame.range[[i]])
}

num.frames = (num.frames -1)*100

total.dist = plot.data
total.dist$last.frame = paste0(total.dist$TrackID,"_",total.dist$Frame)
total.dist = total.dist[total.dist$last.frame %in% paste0(names(max.frame),"_",max.frame),]
row.names(total.dist) = total.dist$TrackID
total.dist$velocity = total.dist$distance/num.frames[row.names(total.dist)]

total.dist$geno = factor(total.dist$geno, unique(total.dist$geno))

par(mar=c(11.25, 4.1, 4.1, 2))


boxplot(total.dist$velocity~total.dist$geno,
        xaxt = 'none',
        xlab = NA,
        col = hex(geno.color, .25),
        ylab = "distance",
        main = "genotype",
        ylim = c(0,max(total.dist$velocity)))

beeswarm(total.dist$velocity~as.numeric(total.dist$geno),
       pch = 21,
       cex = 1.5,
       spacing = 1.5,
       method = "swarm",
       bg = geno.color,
       add = T)


axis(side = 1,
     at = c(1:4),
     labels = c(unique(total.dist$geno)),
     cex = .75,
     las = 2,
     lwd = 0,
     line = -.75)

g3d8=total.dist

```




```{r echo = F}

vials = read.csv("/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/20250717_V1.csv")
vials$VialID = vials$VialID +1
colnames(vials)[3:4] = c("X","Y")

vials$lty = rep(c(1,2), 4)[vials$VialID]
vials$shape = rep(c(23,24),4)[vials$VialID]

vials$geno = c("A4V.F", "A4V.F", "A4V.M", "A4V.M", "WT.F", "WT.F", "WT.M", "WT.M")[vials$VialID]

plot.frames = c(1, c(1:floor(max(vials$Frame)/100))*100)
plot.data = vials[vials$Frame %in% plot.frames,]

frame.range = as.list(rep(0, length(unique(plot.data$TrackID))))
names(frame.range) = unique(plot.data$TrackID)
for(i in 1:length(frame.range)){
  frame.range[[i]] = plot.data[plot.data$TrackID == i, "Frame"]
}




#frame.range[[13]] = frame.range[[13]][1:81]





geno.color = c("firebrick", "royalblue", "darkgreen", "goldenrod")


temp = plot.data[plot.data$TrackID == names(frame.range)[1],]
temp = temp[temp$Frame %in% frame.range[[1]],]


i=2
while(i<=length(frame.range)){
  temp2 = plot.data[plot.data$TrackID == names(frame.range)[i],]
  temp2 = temp2[temp2$Frame %in% frame.range[[i]],]
  temp = rbind(temp, temp2)
  i=i+1
}


plot.data = temp

plot.data$distance = 0

j=1
while(j<=max(plot.data$TrackID)){
  i=2
  while(i <= length(frame.range[[j]])){
  
    x1 = plot.data$X[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    x0 = plot.data$X[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    y1 = plot.data$Y[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    y0 = plot.data$Y[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    dist = sqrt(((x1-x0)^2)+((y1-y0)^2))
    
    plot.data$distance[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j] = plot.data$distance[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j] + dist
    i=i+1
  }
  j=j+1
}

full.plot.data = plot.data

j=1
temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))
  fig1 = fig
  
  j=j+1
  

temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig2 = fig
  
  j=j+1
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig3 = fig
  
  j=j+1
  
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig4 = fig
  
  j=j+1
  
  
  fig <- subplot(fig1, fig2, fig3, fig4, nrows = 2)
  
  annotations = list(list(text = unique(plot.data$geno)[1],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[2],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[3],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 0.4),
                    list(text = unique(plot.data$geno)[4],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 0.4))
  
fig <- fig %>%layout(annotations = annotations) 
  
fig <- fig %>% layout(showlegend = FALSE)
  
fig <- fig %>% layout(
  xaxis = list(range = c(0, max(plot.frames))),
  yaxis = list(range = c(0, max(plot.data$distance))),
  xaxis2 = list(range = c(0, max(plot.frames))),
  yaxis2 = list(range = c(0, max(plot.data$distance))),
  xaxis3 = list(range = c(0, max(plot.frames))),
  yaxis3 = list(range = c(0, max(plot.data$distance))),
  xaxis4 = list(range = c(0, max(plot.frames))),
  yaxis4 = list(range = c(0, max(plot.data$distance)))
)
  
  fig
```


```{r echo = F, fig.height=6}

max.frame = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  max.frame[i] = max(frame.range[[i]])
}

num.frames = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  num.frames[i] = length(frame.range[[i]])
}

num.frames = (num.frames -1)*100

total.dist = plot.data
total.dist$last.frame = paste0(total.dist$TrackID,"_",total.dist$Frame)
total.dist = total.dist[total.dist$last.frame %in% paste0(names(max.frame),"_",max.frame),]
row.names(total.dist) = total.dist$TrackID
total.dist$velocity = total.dist$distance/num.frames[row.names(total.dist)]

total.dist$geno = factor(total.dist$geno, unique(total.dist$geno))

par(mar=c(11.25, 4.1, 4.1, 2))


boxplot(total.dist$velocity~total.dist$geno,
        xaxt = 'none',
        xlab = NA,
        col = hex(geno.color, .25),
        ylab = "Velocity",
        main = "G3 day 9",
        ylim = c(0,max(total.dist$velocity)))

beeswarm(total.dist$velocity~as.numeric(total.dist$geno),
       pch = 21,
       cex = 1.5,
       spacing = 1.5,
       method = "swarm",
       bg = geno.color,
       add = T)


axis(side = 1,
     at = c(1:4),
     labels = c(unique(total.dist$geno)),
     cex = .75,
     las = 2,
     lwd = 0,
     line = -.75)

g3d9=total.dist

```




```{r echo = F}

vials = read.csv("/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/20250721_V5.csv")
vials$VialID = vials$VialID +1
colnames(vials)[3:4] = c("X","Y")

vials$lty = rep(c(1,2), 4)[vials$VialID]
vials$shape = rep(c(23,24),4)[vials$VialID]

vials$geno = c("A4V.F", "A4V.F", "A4V.M", "A4V.M", "WT.F", "WT.F", "WT.M", "WT.M")[vials$VialID]

plot.frames = c(1, c(1:floor(max(vials$Frame)/100))*100)
plot.data = vials[vials$Frame %in% plot.frames,]

frame.range = as.list(rep(0, length(unique(plot.data$TrackID))))
names(frame.range) = unique(plot.data$TrackID)
for(i in 1:length(frame.range)){
  frame.range[[i]] = plot.data[plot.data$TrackID == i, "Frame"]
}




#frame.range[[13]] = frame.range[[13]][1:81]





geno.color = c("firebrick", "royalblue", "darkgreen", "goldenrod")


temp = plot.data[plot.data$TrackID == names(frame.range)[1],]
temp = temp[temp$Frame %in% frame.range[[1]],]


i=2
while(i<=length(frame.range)){
  temp2 = plot.data[plot.data$TrackID == names(frame.range)[i],]
  temp2 = temp2[temp2$Frame %in% frame.range[[i]],]
  temp = rbind(temp, temp2)
  i=i+1
}


plot.data = temp

plot.data$distance = 0

j=1
while(j<=max(plot.data$TrackID)){
  i=2
  while(i <= length(frame.range[[j]])){
  
    x1 = plot.data$X[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    x0 = plot.data$X[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    y1 = plot.data$Y[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j]
    y0 = plot.data$Y[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j]
    dist = sqrt(((x1-x0)^2)+((y1-y0)^2))
    
    plot.data$distance[plot.data$Frame == frame.range[[j]][i] &
                         plot.data$TrackID == j] = plot.data$distance[plot.data$Frame == frame.range[[j]][i-1] &
                         plot.data$TrackID == j] + dist
    i=i+1
  }
  j=j+1
}

full.plot.data = plot.data

j=1
temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))
  fig1 = fig
  
  j=j+1
  

temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig2 = fig
  
  j=j+1
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig3 = fig
  
  j=j+1
  
  
  
  temp.plot.data = plot.data[plot.data$geno == unique(plot.data$geno)[j],]
temp.plot.data$TrackID = factor(temp.plot.data$TrackID, levels = c(unique(temp.plot.data$TrackID)))
temp.plot.data$VialID = factor(temp.plot.data$VialID, levels = unique(temp.plot.data$VialID))
  fig = plot_ly(data = temp.plot.data,
                x = ~Frame,
                y = ~distance,
                type = 'scatter',
                mode = 'lines',
                name = ~TrackID,
                linetype = ~VialID,
                line = list(color = geno.color[j]),
                hoverinfo = "text",
                hovertext = paste("Line:", temp.plot.data$geno,
                                  "\nFly ID: ", temp.plot.data$TrackID,
                                  "\nVial: ", temp.plot.data$VialID,
                                  "\nFrame: ", temp.plot.data$Frame,
                                  "\ndistance", temp.plot.data$distance))

  fig4 = fig
  
  j=j+1
  
  
  fig <- subplot(fig1, fig2, fig3, fig4, nrows = 2)
  
  annotations = list(list(text = unique(plot.data$geno)[1],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[2],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 1.0),
                    list(text = unique(plot.data$geno)[3],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.2,
                         y = 0.4),
                    list(text = unique(plot.data$geno)[4],
                         xref = "paper",
                         yref = "paper",
                         xanchor = "center",
                         yanchor = "bottom",
                         showarrow = FALSE,
                         x = 0.8,
                         y = 0.4))
  
fig <- fig %>%layout(annotations = annotations) 
  
fig <- fig %>% layout(showlegend = FALSE)
  
fig <- fig %>% layout(
  xaxis = list(range = c(0, max(plot.frames))),
  yaxis = list(range = c(0, max(plot.data$distance))),
  xaxis2 = list(range = c(0, max(plot.frames))),
  yaxis2 = list(range = c(0, max(plot.data$distance))),
  xaxis3 = list(range = c(0, max(plot.frames))),
  yaxis3 = list(range = c(0, max(plot.data$distance))),
  xaxis4 = list(range = c(0, max(plot.frames))),
  yaxis4 = list(range = c(0, max(plot.data$distance)))
)
  
  fig
```


```{r echo = F, fig.height=6}

max.frame = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  max.frame[i] = max(frame.range[[i]])
}

num.frames = setNames(rep(0,length(frame.range)), names(frame.range))

i=1
for(i in 1:length(frame.range)){
  num.frames[i] = length(frame.range[[i]])
}

num.frames = (num.frames -1)*100

total.dist = plot.data
total.dist$last.frame = paste0(total.dist$TrackID,"_",total.dist$Frame)
total.dist = total.dist[total.dist$last.frame %in% paste0(names(max.frame),"_",max.frame),]
row.names(total.dist) = total.dist$TrackID
total.dist$velocity = total.dist$distance/num.frames[row.names(total.dist)]

total.dist$geno = factor(total.dist$geno, unique(total.dist$geno))

par(mar=c(11.25, 4.1, 4.1, 2))


boxplot(total.dist$velocity~total.dist$geno,
        xaxt = 'none',
        xlab = NA,
        col = hex(geno.color, .25),
        ylab = "Velocity",
        main = "G4 day 12",
        ylim = c(0,max(total.dist$velocity)))

beeswarm(total.dist$velocity~as.numeric(total.dist$geno),
       pch = 21,
       cex = 1.5,
       spacing = 1.5,
       method = "swarm",
       bg = geno.color,
       add = T)


axis(side = 1,
     at = c(1:4),
     labels = c(unique(total.dist$geno)),
     cex = .75,
     las = 2,
     lwd = 0,
     line = -.75)

g3d9=total.dist

```





```{r}

video.dir = "/Users/johncsantiago/Documents/GitHub/Python/LarvalLocomotion/PreliminaryCode/TrackedVideos/"
files = list.files(video.dir)

WTMG5.1 = files[grep("WTMG5.1", files)] 
WTMG5.1 = WTMG5.1[grep(".csv", WTMG5.1)]

A4VMG5.1 = files[grep("A4VMG5.1", files)] 
A4VMG5.1 = A4VMG5.1[grep(".csv", A4VMG5.1)]

WTMG6.1 = files[grep("WTMG6.1", files)] 
WTMG6.1 = WTMG6.1[grep(".csv", WTMG6.1)]

A4VMG6.1 = files[grep("A4VMG6.1", files)] 
A4VMG6.1 = A4VMG6.1[grep(".csv", A4VMG6.1)]

WTMG6.2 = files[grep("WTMG6.2", files)] 
WTMG6.2 = WTMG6.2[grep(".csv", WTMG6.2)]

A4VMG6.2 = files[grep("A4VMG6.2", files)] 
A4VMG6.2 = A4VMG6.2[grep(".csv", A4VMG6.2)]


samples = c(list(WTMG5.1  = WTMG5.1,
                 A4VMG5.1 = A4VMG5.1,
                 WTMG6.1  = WTMG6.1,
                 A4VMG6.1 = A4VMG6.1,
                 WTMG6.2  = WTMG6.2,
                 A4VMG6.2 = A4VMG6.2))

process.activity = function(sample.data){

  names.all.sample.data = strsplit(sample.data, split = "_")
  
  all.sample.data = as.list(1:length(sample.data))
  n=1
  while(n<=length(names.all.sample.data)){
    day = names.all.sample.data[[n]][2]
    d = 1
    while(d<=length(day)){
      if(nchar(day[d])==2){
        day[d] = paste0("d0", substr(day[d],2,2))
      }
      d=d+1
    }
    names(all.sample.data)[[n]] = day
    n=n+1
  }
  
  t = 1
  while(t<= length(sample.data)){
    temp.file = read.csv(paste0(video.dir, sample.data[t]))
    IDs = unique(temp.file$TrackID)
    
    plot.frames = c(1, c(1:floor(max(temp.file$Frame)/100))*100)
    temp.file = temp.file[temp.file$Frame %in% plot.frames,]
  
    sample = strsplit(sample.data[t], split = "_")[[1]]
    all.data = data.frame(Frame = numeric(),
                          ID = character(),
                          X = numeric(),
                          Y = numeric(),
                          distance = numeric())
    
    i=1
    while(i<=length(IDs)){

      temp.sampledata = temp.file[temp.file$TrackID == IDs[i],]
      temp.all.data = data.frame(Frame = temp.sampledata$Frame,
                                 ID = i,
                                 X = temp.sampledata$CX,
                                 Y = temp.sampledata$CY,
                                 distance = 0)

      temp.all.data[1, "distance"] = 0
      
      f=2
      while(f<=length(temp.sampledata$Frame)){
        x1 = temp.sampledata[f-1,"CX"]
        x2 = temp.sampledata[f,"CX"]
        y1 = temp.sampledata[f-1,"CY"]
        y2 = temp.sampledata[f,"CY"]
        dx = x2 - x1
        dy = y2 - y1
        deltad =   sqrt((dx^2)+(dy^2))
        pred = temp.all.data[f-1,
                        "distance"]
        temp.all.data[f, 
                 "distance"] = pred + deltad
        f=f+1
      }
      all.data = rbind(all.data, temp.all.data)
    i=i+1
    }
    all.sample.data[[t]] = all.data
    t=t+1
  }
  all.sample.data = all.sample.data[order(names(all.sample.data))]
  return(all.sample.data)
}


processed.sample.data = samples
run = 1
while(run<=length(samples)){
  processed.sample.data[[run]] = process.activity(samples[[run]])
  run = run +1
}

gen.options = as.list(names(processed.sample.data))
names(gen.options) = names(processed.sample.data)
i = 1
while(i<=length(gen.options)){
  gen.options[[i]]=names(processed.sample.data[[i]])
  i=i+1
}

```


```{r echo = F}

geno.color = c("firebrick", "royalblue", "darkgreen", "goldenrod", "deeppink")

plot.dist= function(plot.gen,plot.day){
  maxdist = 0
  maxframe = 0
  
  
  j=1
  temp.plot.data = processed.sample.data[[plot.gen[1]]][[plot.day]]
  
  
    fig = plot_ly(data = temp.plot.data,
                  x = ~Frame,
                  y = ~distance,
                  type = 'scatter',
                  mode = 'lines',
                  name = ~ID,
                  line = list(color = geno.color[j]),
                  hoverinfo = "text",
                  hovertext = paste("Fly ID: ", temp.plot.data$ID,
                                    "\nFrame: ", temp.plot.data$Frame,
                                    "\ndistance", temp.plot.data$distance))
    fig1 = fig
    
    maxdist = max(maxdist, temp.plot.data$distance)
    maxframe = max(maxframe, temp.plot.data$Frame)
    j=j+1
  
    
  
  if(length(plot.gen)>1){
    if(length(gen.options[[plot.gen[2]]])>=plot.day){
      temp.plot.data = processed.sample.data[[plot.gen[2]]][[plot.day]]
      fig = plot_ly(data = temp.plot.data,
                    x = ~Frame,
                    y = ~distance,
                    type = 'scatter',
                    mode = 'lines',
                    name = ~ID,
                    line = list(color = geno.color[j]),
                    hoverinfo = "text",
                    hovertext = paste("Fly ID: ", temp.plot.data$ID,
                                      "\nFrame: ", temp.plot.data$Frame,
                                      "\ndistance", temp.plot.data$distance))
      fig2 = fig
      
      maxdist = max(maxdist, temp.plot.data$distance)
      maxframe = max(maxframe, temp.plot.data$Frame)
      
      fig <- subplot(fig1, fig2, nrows = 1)
      
      annotations = list(list(text = paste0(names(processed.sample.data)[[plot.gen[1]]], " ",
                                            names(processed.sample.data[[plot.gen[1]]])[plot.day]),
                             xref = "paper",
                             yref = "paper",
                             xanchor = "center",
                             yanchor = "bottom",
                             showarrow = FALSE,
                             x = 0.2,
                             y = 1.0),
                        list(text =  paste0(names(processed.sample.data)[[plot.gen[2]]], " ",
                                            names(processed.sample.data[[plot.gen[2]]])[plot.day]),
                             xref = "paper",
                             yref = "paper",
                             xanchor = "center",
                             yanchor = "bottom",
                             showarrow = FALSE,
                             x = 0.8,
                             y = 1.0))
      
    fig <- fig %>%layout(annotations = annotations) 
      
    fig <- fig %>% layout(showlegend = FALSE)
    
    fig <- fig %>% layout(
      xaxis = list(range = c(0, maxframe)),
      yaxis = list(range = c(0, maxdist)),
      xaxis2 = list(range = c(0, maxframe)),
      yaxis2 = list(range = c(0, maxdist))
    )
    }}
    if(length(plot.gen)==1){
    fig <- fig1
        
    fig <- fig %>% layout(showlegend = FALSE)
      
    fig <- fig %>% layout(
      xaxis = list(range = c(0, maxframe)),
      yaxis = list(range = c(0, maxdist)),
      title = paste0(names(processed.sample.data)[[plot.gen[1]]], " ",
                     names(processed.sample.data[[plot.gen[1]]])[plot.day])
      )
    }
    if(length(plot.gen)==2){
      if(plot.day>length(gen.options[[plot.gen[2]]])){
      fig <- fig1
          
      fig <- fig %>% layout(showlegend = FALSE)
        
      fig <- fig %>% layout(
        xaxis = list(range = c(0, maxframe)),
        yaxis = list(range = c(0, maxdist)),
        title = paste0(names(processed.sample.data)[[plot.gen[1]]], " ",
                       names(processed.sample.data[[plot.gen[1]]])[plot.day])
        )
    }}
    fig
}


```


```{r echo = F}

plot.gen = c(1,2)
plot.day = 1

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(1,2)
plot.day = 2

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(1,2)
plot.day = 3

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(1,2)
plot.day = 4

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(1,2)
plot.day = 5

plot.dist(plot.gen,plot.day)

```




```{r echo = F}

plot.gen = c(1,2)
plot.day = 6

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(1,2)
plot.day = 7

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(1,2)
plot.day = 8

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(1,2)
plot.day = 9

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(1,2)
plot.day = 10

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(1,2)
plot.day = 11

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(1,2)
plot.day = 12

plot.dist(plot.gen,plot.day)

```




```{r echo = F}

plot.gen = c(3,4)
plot.day = 1

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(3,4)
plot.day = 2

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(3,4)
plot.day = 3

plot.dist(plot.gen,plot.day)

```




```{r echo = F}

plot.gen = c(3,4)
plot.day = 4

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(3,4)
plot.day = 5

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(3,4)
plot.day = 6

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(3,4)
plot.day = 7

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(3,4)
plot.day = 8

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(3,4)
plot.day = 9

plot.dist(plot.gen,plot.day)

```




```{r echo = F}

plot.gen = c(3,4)
plot.day = 10

plot.dist(plot.gen,plot.day)

```




```{r echo = F}

plot.gen = c(3,4)
plot.day = 11

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(3,4)
plot.day = 12

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(3,4)
plot.day = 13

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(3,4)
plot.day = 14

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 1

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(5,6)
plot.day = 2

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(5,6)
plot.day = 3

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 4

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 5

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 6

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 7

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(5,6)
plot.day = 8

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 9

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(5,6)
plot.day = 10

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 11

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 12

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 13

plot.dist(plot.gen,plot.day)

```

```{r echo = F}

plot.gen = c(5,6)
plot.day = 14

plot.dist(plot.gen,plot.day)

```

```{r echo = F}

plot.gen = c(5,6)
plot.day = 15

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 16

plot.dist(plot.gen,plot.day)

```

```{r echo = F}

plot.gen = c(5,6)
plot.day = 17

plot.dist(plot.gen,plot.day)

```


```{r echo = F}

plot.gen = c(5,6)
plot.day = 18

plot.dist(plot.gen,plot.day)

```



```{r echo = F}

plot.gen = c(5,6)
plot.day = 19

plot.dist(plot.gen,plot.day)

```


```{r echo = F}


all.total.dist=processed.sample.data
all.total.frame=processed.sample.data
i =1
while(i<=length(processed.sample.data)){
  j=1
  while(j<=length(processed.sample.data[[i]])){
    current.data = processed.sample.data[[i]][[j]]
    all.total.dist[[i]][[j]]=setNames(rep(0, length(unique(current.data$ID))), unique(current.data$ID))
    all.total.frame[[i]][[j]]=setNames(rep(0, length(unique(current.data$ID))), unique(current.data$ID))
    k=1
    while(k<= length(all.total.dist[[i]][[j]])){
      all.total.dist[[i]][[j]][k] = max(current.data[current.data$ID == unique(current.data$ID)[k], "distance"])
      all.total.frame[[i]][[j]][k] = max(current.data[current.data$ID == unique(current.data$ID)[k], "Frame"])
    k=k+1
    }
    j=j+1
  }
  i=i+1
}

data.summary = data.frame(Sample = names(unlist(all.total.frame)),
                          Genotype = "",
                          Generation = "",
                          Day = "",
                          ID = "",
                          Distance = 0,
                          Frame = 0)
i=1
while(i <= length(unlist(all.total.frame))){
  data.summary[i,"Genotype"] = strsplit(names(unlist(all.total.frame)), "M")[[i]][1]
  data.summary[i,"Generation"] = strsplit(names(unlist(all.total.frame)), "G")[[i]][2]
  data.summary[i,"Generation"] = strsplit(data.summary[i,"Generation"], ".d")[[1]][1]
  data.summary[i,"Day"] = strsplit(names(unlist(all.total.frame)), ".d")[[i]][2]
  data.summary[i, c("Day", "ID")] = c(substr(data.summary[i,"Day"], 1,(nchar(data.summary[i,"Day"])-2)),
                                      substr(data.summary[i,"Day"], nchar(data.summary[i,"Day"]),nchar(data.summary[i,"Day"])))
  data.summary[i, "Distance"] = unlist(all.total.dist)[names(unlist(all.total.frame))[i]]
  data.summary[i, "Frame"] = unlist(all.total.frame)[names(unlist(all.total.frame))[i]]
  i=i+1
}

data.summary$Velocity = data.summary$Distance/data.summary$Frame

mean.data.summary = data.summary
mean.data.summary$Group = paste0(data.summary[,"Genotype"],"G",data.summary[,"Generation"], "_d",data.summary[,"Day"])
mean.data.summary = mean.data.summary[!duplicated(mean.data.summary$Group),]

mean.data.summary = mean.data.summary[,c("Group", "Genotype", "Generation",
                                         "Day", "Velocity")]

i=1
while(i<=nrow(mean.data.summary)){
  temp = data.summary[data.summary$Genotype == mean.data.summary$Genotype[i],]
  temp = temp[temp$Generation == mean.data.summary$Generation[i],]
  temp = temp[temp$Day == mean.data.summary$Day[i],]
  mean.data.summary$Velocity[i] = sum(temp$Velocity)/nrow(temp)
  i=i+1
}



fulldataset.mean = data.summary
fulldataset.mean$Group = paste0(data.summary[,"Genotype"], "_d",data.summary[,"Day"])
fulldataset.mean = fulldataset.mean[!duplicated(fulldataset.mean$Group),]

fulldataset.mean = fulldataset.mean[,c("Group", "Genotype",
                                         "Day", "Velocity")]

i=1
while(i<=nrow(fulldataset.mean)){
  temp = data.summary[data.summary$Genotype == fulldataset.mean$Genotype[i],]
  temp = temp[temp$Day == fulldataset.mean$Day[i],]
  fulldataset.mean$Velocity[i] = sum(temp$Velocity)/nrow(temp)
  i=i+1
}


```


```{r echo = F, fig.width=8, fig.height=5}

plot.data = data.summary[data.summary$Generation == "5.1",]
plot.data$level = "2"
plot.data[plot.data$Genotype == "WT", "level"] = "1"
plot.data$color = geno.color[2:1][as.numeric(plot.data$level)]
plot.data$Group = paste(plot.data$Day, plot.data$level, plot.data$Genotype)

all.days.groups = data.frame(Day = rep(unique(plot.data$Day), 2),
                             level = c(rep("1", length(unique(plot.data$Day))),
                                       rep("2", length(unique(plot.data$Day)))),
                             Genotype = c(rep("WT", length(unique(plot.data$Day))),
                                       rep("A4V", length(unique(plot.data$Day)))))
all.days.groups = paste(all.days.groups$Day, 
                        all.days.groups$level, 
                        all.days.groups$Genotype)
                             
all.days.groups = all.days.groups[order(all.days.groups)]

plot.data$Group = factor(plot.data$Group, levels = all.days.groups)

plot.color = unique(plot.data[,c("Group", "color")])
plot.color = plot.color[order(plot.color$Group),]
mean.plot.data = mean.data.summary[mean.data.summary$Group 
                                   %in%
                                     paste0(plot.data[,"Genotype"],"G",plot.data[,"Generation"], "_d",plot.data[,"Day"]),]


par(mar = c(4,4,3,5))

boxplot(plot.data$Velocity~plot.data$Group,
        xaxt = 'none',
        xlab = NA,
        col = hex(plot.color$color, .15),
        ylab = "Velocity",
        main = paste("Generation", plot.data$Generation[1]),
        ylim = c(0,max(plot.data$Velocity)),
        las = 2)

beeswarm(plot.data$Velocity~plot.data$Group,
       pch = 21,
       cex = 1.0,
       xlim = c(0,30),
       spacing = .50,
       method = "swarm",
       bg =hex(plot.color$color, .35),
       add = T)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     col = "royalblue",
     lwd = 2)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     col = "firebrick",
     lwd = 2)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     bg = "royalblue",
     pch = 23)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     bg = "firebrick",
     pch = 23)



axis(side = 1,
     at = (c(1:12)*2)-.5,
     labels = c(as.numeric(unique(plot.data$Day))),
     cex = .75,
     las = 1,
     lwd = 0,
     line = -.75)

legend("topright",
         inset=c(-.15,0),
         legend = c("WT", "A4V"), 
         fill = hex(c("royalblue","firebrick"), .5),
         cex = 1,
         bty = 'n',
         pt.cex = 1,
       xpd = T)



```


```{r echo = F, fig.width=8, fig.height=5}

plot.data = data.summary[data.summary$Generation == "6.1",]
plot.data$level = "2"
plot.data[plot.data$Genotype == "WT", "level"] = "1"
plot.data$color = geno.color[2:1][as.numeric(plot.data$level)]
plot.data$Group = paste(plot.data$Day, plot.data$level, plot.data$Genotype)

all.days.groups = data.frame(Day = rep(unique(plot.data$Day), 2),
                             level = c(rep("1", length(unique(plot.data$Day))),
                                       rep("2", length(unique(plot.data$Day)))),
                             Genotype = c(rep("WT", length(unique(plot.data$Day))),
                                       rep("A4V", length(unique(plot.data$Day)))))
all.days.groups = paste(all.days.groups$Day, 
                        all.days.groups$level, 
                        all.days.groups$Genotype)
                             
all.days.groups = all.days.groups[order(all.days.groups)]

plot.data$Group = factor(plot.data$Group, levels = all.days.groups)

plot.color = unique(plot.data[,c("Group", "color")])
plot.color = plot.color[order(plot.color$Group),]
mean.plot.data = mean.data.summary[mean.data.summary$Group 
                                   %in%
                                     paste0(plot.data[,"Genotype"],"G",plot.data[,"Generation"], "_d",plot.data[,"Day"]),]


par(mar = c(4,4,3,5))

boxplot(plot.data$Velocity~plot.data$Group,
        xaxt = 'none',
        xlab = NA,
        col = hex(plot.color$color, .15),
        ylab = "Velocity",
        main = paste("Generation", plot.data$Generation[1]),
        ylim = c(0,max(plot.data$Velocity)),
        las = 2)

beeswarm(plot.data$Velocity~plot.data$Group,
       pch = 21,
       cex = 1.0,
       xlim = c(0,30),
       spacing = .50,
       method = "swarm",
       bg =hex(plot.color$color, .35),
       add = T)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     col = "royalblue",
     lwd = 2)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     col = "firebrick",
     lwd = 2)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     bg = "royalblue",
     pch = 23)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     bg = "firebrick",
     pch = 23)



axis(side = 1,
     at = (c(1:14)*2)-.5,
     labels = c(as.numeric(unique(plot.data$Day))),
     cex = .75,
     las = 1,
     lwd = 0,
     line = -.75)

legend("topright",
         inset=c(-.15,0),
         legend = c("WT", "A4V"), 
         fill = hex(c("royalblue","firebrick"), .5),
         cex = 1,
         bty = 'n',
         pt.cex = 1,
       xpd = T)



```


```{r echo = F, fig.width=8, fig.height=5}

plot.data = data.summary[data.summary$Generation == "6.2",]
plot.data$level = "2"
plot.data[plot.data$Genotype == "WT", "level"] = "1"
plot.data$color = geno.color[2:1][as.numeric(plot.data$level)]
plot.data$Group = paste(plot.data$Day, plot.data$level, plot.data$Genotype)

all.days.groups = data.frame(Day = rep(unique(plot.data$Day), 2),
                             level = c(rep("1", length(unique(plot.data$Day))),
                                       rep("2", length(unique(plot.data$Day)))),
                             Genotype = c(rep("WT", length(unique(plot.data$Day))),
                                       rep("A4V", length(unique(plot.data$Day)))))
all.days.groups = paste(all.days.groups$Day, 
                        all.days.groups$level, 
                        all.days.groups$Genotype)
                             
all.days.groups = all.days.groups[order(all.days.groups)]

plot.data$Group = factor(plot.data$Group, levels = all.days.groups)

plot.color = unique(plot.data[,c("Group", "color")])
plot.color = plot.color[order(plot.color$Group),]
mean.plot.data = mean.data.summary[mean.data.summary$Group 
                                   %in%
                                     paste0(plot.data[,"Genotype"],"G",plot.data[,"Generation"], "_d",plot.data[,"Day"]),]


par(mar = c(4,4,3,5))

boxplot(plot.data$Velocity~plot.data$Group,
        xaxt = 'none',
        xlab = NA,
        col = hex(plot.color$color, .15),
        ylab = "Velocity",
        main = paste("Generation", plot.data$Generation[1]),
        ylim = c(0,max(plot.data$Velocity)),
        las = 2)

beeswarm(plot.data$Velocity~plot.data$Group,
       pch = 21,
       cex = 1.0,
       xlim = c(0,30),
       spacing = .50,
       method = "swarm",
       bg =hex(plot.color$color, .35),
       add = T)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     col = "royalblue",
     lwd = 2)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     col = "firebrick",
     lwd = 2)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     bg = "royalblue",
     pch = 23)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     bg = "firebrick",
     pch = 23)



axis(side = 1,
     at = (c(1:19)*2)-.5,
     labels = c(as.numeric(unique(plot.data$Day))),
     cex = .75,
     las = 1,
     lwd = 0,
     line = -.75)

legend("topright",
         inset=c(-.15,0),
         legend = c("WT", "A4V"), 
         fill = hex(c("royalblue","firebrick"), .5),
         cex = 1,
         bty = 'n',
         pt.cex = 1,
       xpd = T)



```





```{r echo = F, fig.width=8, fig.height=5}

plot.data = data.summary
plot.data$level = "2"
plot.data[plot.data$Genotype == "WT", "level"] = "1"
plot.data$color = geno.color[2:1][as.numeric(plot.data$level)]
plot.data$Group = paste(plot.data$Day, plot.data$level, plot.data$Genotype)

all.days.groups = data.frame(Day = rep(unique(plot.data$Day), 2),
                             level = c(rep("1", length(unique(plot.data$Day))),
                                       rep("2", length(unique(plot.data$Day)))),
                             Genotype = c(rep("WT", length(unique(plot.data$Day))),
                                       rep("A4V", length(unique(plot.data$Day)))))
all.days.groups = paste(all.days.groups$Day, 
                        all.days.groups$level, 
                        all.days.groups$Genotype)
                             
all.days.groups = all.days.groups[order(all.days.groups)]

plot.data$Group = factor(plot.data$Group, levels = all.days.groups)

plot.color = unique(plot.data[,c("Group", "color")])
plot.color = plot.color[order(plot.color$Group),]
mean.plot.data = fulldataset.mean


par(mar = c(4,4,3,5))

boxplot(plot.data$Velocity~plot.data$Group,
        xaxt = 'none',
        xlab = NA,
        col = hex(plot.color$color, .15),
        ylab = "Velocity",
        main = "All Generations",
        ylim = c(0,max(plot.data$Velocity)),
        las = 2)

beeswarm(plot.data$Velocity~plot.data$Group,
       pch = 21,
       cex = 1.0,
       xlim = c(0,30),
       spacing = .50,
       method = "swarm",
       bg =hex(plot.color$color, .35),
       add = T)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     col = "royalblue",
     lwd = 2)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     col = "firebrick",
     lwd = 2)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     bg = "royalblue",
     pch = 23)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     bg = "firebrick",
     pch = 23)



axis(side = 1,
     at = (c(1:23)*2)-.5,
     labels = c(as.numeric(unique(plot.data$Day)))[order(c(as.numeric(unique(plot.data$Day))))],
     cex = .75,
     las = 1,
     lwd = 0,
     line = -.75)

legend("topright",
         inset=c(-.15,0),
         legend = c("WT", "A4V"), 
         fill = hex(c("royalblue","firebrick"), .5),
         cex = 1,
         bty = 'n',
         pt.cex = 1,
       xpd = T)



```





```{r echo = F, fig.width=8, fig.height=5}

plot.data = data.summary[!(data.summary$Genotype == "A4V" & data.summary$Day > 17),]
plot.data$level = "2"
plot.data[plot.data$Genotype == "WT", "level"] = "1"
plot.data$color = geno.color[2:1][as.numeric(plot.data$level)]
plot.data$Group = paste(plot.data$Day, plot.data$level, plot.data$Genotype)

all.days.groups = data.frame(Day = rep(unique(plot.data$Day), 2),
                             level = c(rep("1", length(unique(plot.data$Day))),
                                       rep("2", length(unique(plot.data$Day)))),
                             Genotype = c(rep("WT", length(unique(plot.data$Day))),
                                       rep("A4V", length(unique(plot.data$Day)))))
all.days.groups = paste(all.days.groups$Day, 
                        all.days.groups$level, 
                        all.days.groups$Genotype)
                             
all.days.groups = all.days.groups[order(all.days.groups)]

plot.data$Group = factor(plot.data$Group, levels = all.days.groups)


plot.color = data.frame(Group = all.days.groups,
                        color = NA)
plot.color[plot.color$Group %in% plot.data$Group, "color"] = "royalblue"
plot.color[plot.color$Group %in% plot.data$Group[grep("A4V",plot.data$Group)], "color"] = "firebrick"


mean.plot.data = fulldataset.mean[!(fulldataset.mean$Genotype == "A4V" & fulldataset.mean$Day > 17),]
mean.plot.data = mean.plot.data[order(mean.plot.data$Day),]


par(mar = c(4,4,3,5))

boxplot(plot.data$Velocity~plot.data$Group,
        xaxt = 'none',
        xlab = NA,
        col = hex(plot.color$color, .15),
        ylab = "Velocity",
        main = "All Generations",
        ylim = c(0,max(plot.data$Velocity)),
        las = 2)

beeswarm(plot.data$Velocity~plot.data$Group,
       pch = 21,
       cex = 1.0,
       xlim = c(0,30),
       spacing = .50,
       method = "swarm",
       bg =hex(plot.color$color, .35),
       add = T)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     col = "royalblue",
     lwd = 2)

lines(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     col = "firebrick",
     lwd = 2)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "WT", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "WT", "Velocity"]),
     bg = "royalblue",
     pch = 23)

points(x = ((1:length(mean.plot.data[mean.plot.data$Genotype == "A4V", "Day"]))*2)-.5,
     y = as.numeric(mean.plot.data[mean.plot.data$Genotype == "A4V", "Velocity"]),
     bg = "firebrick",
     pch = 23)



axis(side = 1,
     at = (c(1:23)*2)-.5,
     labels = c(as.numeric(unique(plot.data$Day)))[order(c(as.numeric(unique(plot.data$Day))))],
     cex.axis = .5,
     las = 1,
     lwd = 0,
     line = -.75)

legend("topright",
         inset=c(-.15,0),
         legend = c("WT", "A4V"), 
         fill = hex(c("royalblue","firebrick"), .5),
         cex = 1,
         bty = 'n',
         pt.cex = 1,
       xpd = T)



```

```{r echo = F}

t.data = plot.data
t.data = t.data[order(t.data$Group),]
t.data$Group = paste0(t.data$Genotype, "_day", t.data$Day)
groups = unique(t.data$Group)

t.table = data.frame(Genotype1 = character(),
                     Genotype2 = character(),
                     pval = numeric())

i=1
while(i <= length(groups)){
  j = i+1
  while(j <= length(groups)){
    t.temp = data.frame(Genotype1 = groups[i],
                        Genotype2 = groups[j],
                        pval = t.test(x = t.data[t.data$Group == groups[i],
                                                 "Velocity"],
                                      y = t.data[t.data$Group == groups[j],
                                                 "Velocity"],
                                      paired = F)[[3]])
    t.table = rbind(t.table, t.temp)
      j = j+1
  }
  i = i+1
}


t.stripe = t.table$pval <= .05
knitr::kable(t.table,
             caption = 'All t-tests for velocity data.')  %>%
kable_styling() %>%
row_spec(c(1:nrow(t.table))[t.table$pval <= .05], bold = T, color = "black", background = "gold")

```



